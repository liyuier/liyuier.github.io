---
title: ä¸ªäººåšå®¢çš„æ­å»ºä¸éƒ¨ç½²
titleTemplate: '%s - yuier'
date: 2025-03-10 21:32:16
updated: 2025-03-10 21:32:16
author: yuier
cover: 
hide: true
---

## ç¼˜èµ·

> ä½ è®¤è¯† [äº‘æ¸¸å›](https://www.yunyoujun.cn/) å—ï¼Ÿ

æ•°å¹´å‰ï¼Œå…´è¶£ä½¿ç„¶åœ°ï¼Œæˆ‘åœ¨äº‘æ¸¸çš„ä¸€ç¯‡[æ•™ç¨‹](https://www.yunyoujun.cn/posts/how-to-build-your-site)çš„æŒ‡å¯¼ä¸‹æˆåŠŸæ­å»ºèµ·äº†æˆ‘çš„ç¬¬ä¸€ä¸ªåšå®¢ç½‘ç«™ã€‚ä¸è¿‡å¾ˆå¿«æˆ‘ä¾¿å°†å…¶æŠ›ä¹‹è„‘åï¼Œç°åœ¨è¿å½“æ—¶çš„åŸŸåéƒ½æƒ³ä¸èµ·æ¥äº†ã€‚

[ä¸¤å¹´åŠ](https://zh.moegirl.org.cn/%E9%B8%A1%E4%BD%A0%E5%A4%AA%E7%BE%8E)å‰ï¼Œäº‘æ¸¸å¼€å§‹å¼€å‘å¹¶å®£ä¼ ä»–çš„ [Valaxy](https://valaxy.site/) æ¡†æ¶ã€‚ä¸¤å‘¨å‰ï¼Œæˆ‘å¼€å§‹è€ƒè™‘é‡æ–°æ­å»ºæˆ‘çš„ä¸ªäººåšå®¢ï¼›ä¸¤å¤©å‰ï¼Œæˆ‘å¼€å§‹éƒ¨ç½²æˆ‘çš„åšå®¢ã€‚

å¯æƒœçš„æ˜¯ï¼Œå½“åˆäº‘æ¸¸çš„é‚£ç¯‡å…¥é—¨çº§æ•™ç¨‹ä¸­åªè®²äº†å¦‚ä½•ç™½å«– GitHub Pages, å¹¶æœªæ¶‰åŠå¦‚ä½•å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°ä¸ªäººæœåŠ¡å™¨ä¸Šï¼›è€Œä¸”éšç€åšå®¢æ¡†æ¶çš„æ”¹å˜ï¼Œå½“åˆçš„æ•™ç¨‹å·²ç»ä¸å†é€‚åˆæ–°çš„åšå®¢ã€‚å› æ­¤ï¼Œæˆ‘åœ¨è¿™é‡Œé‡æ–°è®°å½•ä¸‹æˆ‘çš„éƒ¨ç½²è¿‡ç¨‹ã€‚

<!-- more -->

å½“ç„¶ï¼Œä½œä¸ºä¸ªäººè®°å½•ï¼Œæˆ‘ä¼šç•¥è¿‡å¾ˆå¤šåŸºç¡€ä½†ç¹ççš„å†…å®¹ï¼›æˆ‘å‡è®¾è¯»è€…èƒ½å¤Ÿè‡ªå·±æå®šæˆ‘æ–‡ä¸­æœªæåˆ°çš„æ‰€æœ‰æ­¥éª¤ï¼Œå¦‚æœ‰ä¸è¶³æœ›æµ·æ¶µã€‚

## æ­å»ºåšå®¢

è¿™é‡Œå°±ä¸ç»†è®²äº†ï¼ŒValaxy çš„æ–‡æ¡£å†™å¾—è¿˜æ˜¯æŒºè¯¦ç»†çš„ï¼Œç…§ç€åšæ²¡é—®é¢˜ï¼š[å¿«é€Ÿä¸Šæ‰‹](https://valaxy.site/guide/getting-started)

è®°å¾—å¯¹é»˜è®¤é…ç½®è¿›è¡Œä¸ªæ€§åŒ–çš„ä¿®æ”¹ã€‚å¦‚æœå¯¹æˆ‘çš„ä¿®æ”¹æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŠŠæˆ‘çš„ä»“åº“å…‹éš†åˆ°æœ¬åœ°å‚è€ƒï¼š

[liyuier.github.io](https://github.com/liyuier/liyuier.github.io)

## éƒ¨ç½²åšå®¢

### æ€»ä½“æ€è·¯

éƒ¨ç½²æ–¹æ¡ˆä¸º GitHub Pages ä¸ä¸ªäººæœåŠ¡å™¨åŒéƒ¨ç½²ã€‚GitHub Pages ä½¿ç”¨ Valaxy æä¾›å¥½çš„å·¥ä½œæµæ–‡ä»¶å³å¯ã€‚ä¸ªäººæœåŠ¡å™¨ä¸Šï¼Œæˆ‘æ­å»ºäº†ä¸€ä¸ªè¿œç¨‹ git ä»“åº“ï¼Œå¹¶ä½¿ç”¨ git hooks ï¼Œæ”¶åˆ°æœ¬åœ°æ¨é€åï¼Œå°†ä»£ç å†å…‹éš†åˆ°æœåŠ¡å™¨ä¸Šçš„æ„å»ºç›®å½•ï¼›å†æ‰§è¡Œæ„å»ºå‘½ä»¤ï¼Œæœ€åå°†æ„å»ºå‡ºçš„æ–‡ä»¶å¤åˆ¶åˆ° nginx å·¥ä½œç›®å½•ï¼Œæœ€ç»ˆè‡ªåŠ¨éƒ¨ç½²ã€‚

### å‡†å¤‡å·¥ä½œ

#### è¿œç¨‹ä»“åº“

è§æˆ‘çš„å¦ä¸€ç¯‡åšæ–‡ [æ­å»ºè‡ªå·±çš„ git è¿œç¨‹ä»“åº“æœåŠ¡](https://yuier.com/posts/001-build-self-gitrepo-server)

æœ€ç»ˆæ­å»ºå‡ºçš„åšå®¢è¿œç¨‹ä»“åº“åœ°å€ä¸º `/home/git/repos/liyuier.github.io.git`

#### æ„å»ºç›®å½•

`/usr/dev/blog/liyuier.github.io` . å®é™…ä¸Šå°±æ˜¯åœ¨æœåŠ¡å™¨ä¸Šçš„ â€œæœ¬åœ°ä»“åº“â€

#### nginx å·¥ä½œç›®å½•

`/usr/share/nginx/html` . ç”¨äºä¿å­˜æ„å»ºåçš„æ–‡ä»¶

#### æƒé™èµ‹äºˆ

git hook è„šæœ¬ç”± `git` ç”¨æˆ·æ‰§è¡Œï¼Œè€Œè„šæœ¬éœ€è¦æœ‰æƒé™ä¿®æ”¹ nginx çš„å·¥ä½œç›®å½•ã€‚ä¸ºæ­¤éœ€è¦è¿›è¡Œæƒé™ä¿®æ”¹ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œnginx ç”± `www-data` ç»„ä¸‹çš„ `www-data` ç”¨æˆ·æ‰§è¡Œå·¥ä½œè¿›ç¨‹ã€‚ä¸ºäº†å®ç°æˆ‘ä»¬çš„ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦å°† nginx å·¥ä½œç›®å½•æ‰€å±çš„ç”¨æˆ·ç»„æ”¹ä¸º `www-data` ï¼Œç„¶åèµ‹äºˆç»„å†…æˆå‘˜å¯¹è¯¥ç›®å½•çš„å…¨è¯»å†™æ‰§è¡Œæƒé™ï¼Œæœ€åå°† `git` ç”¨æˆ·åŠ å…¥ `www-data` ç»„å†…ã€‚

```bash
# 1. å°†ç›®å½•ç»„æ”¹ä¸º www-data
sudo chgrp -R www-data /usr/share/nginx/html
# 2. èµ‹äºˆ www-data ç»„è¯»å†™æ‰§è¡Œæƒé™
sudo chmod -R g+rwx /usr/share/nginx/html
# 3. å°† git ç”¨æˆ·åŠ å…¥ www-data ç»„
sudo usermod -aG www-data git
```

### å¼€å§‹å·¥ä½œ

#### hook è„šæœ¬ç¼–å†™

è¿›å…¥è¿œç¨‹ä»“åº“çš„ `hooks` ç›®å½•ä¸‹ï¼Œå³ `/home/git/repos/liyuier.github.io.git/hooks` ç›®å½•

åˆ›å»ºåä¸º `post-receive` çš„æ–‡ä»¶ï¼Œå¹¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š

```bash [post-receive]
# å®šä¹‰æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆæ¨èå­˜æ”¾åœ¨ git ç”¨æˆ·æœ‰æƒé™çš„ç›®å½•ï¼‰
LOG_FILE="/home/git/logs/blog_deploy.log"
DEPLOY_LOG_DIR=$(dirname "$LOG_FILE")

# åˆ›å»ºæ—¥å¿—ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
mkdir -p "$DEPLOY_LOG_DIR"
chown git:git "$DEPLOY_LOG_DIR"  # ç¡®ä¿ç›®å½•æ‰€æœ‰æƒ

# é‡å®šå‘æ‰€æœ‰è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼ˆè¿½åŠ æ¨¡å¼ï¼‰
exec >> "$LOG_FILE" 2>&1

# æ·»åŠ æ—¶é—´æˆ³åˆ†éš”ç¬¦
echo -e "\n\n=== $(date '+%Y-%m-%d %H:%M:%S') å¼€å§‹éƒ¨ç½² ==="

#!/bin/bash  # æŒ‡å®šä½¿ç”¨ bash shell è§£é‡Šå™¨

# å®šä¹‰å˜é‡ï¼šå·¥ä½œç›®å½•è·¯å¾„ï¼ˆå¿…é¡»ä¸ä¹‹å‰åˆ›å»ºçš„ç›®å½•ä¸€è‡´ï¼‰
TARGET="/usr/dev/blog/liyuier.github.io"

# å®šä¹‰å˜é‡ï¼šNginx çš„ç½‘ç«™æ ¹ç›®å½•ï¼ˆæœ€ç»ˆéƒ¨ç½²ä½ç½®ï¼‰
DEPLOY_DIR="/usr/share/nginx/html"

# å®šä¹‰å˜é‡ï¼šGit è£¸ä»“åº“è·¯å¾„ï¼ˆç”¨äº git å‘½ä»¤æ“ä½œï¼‰
GIT_DIR="/home/git/repos/liyuier.github.io.git"

echo "âœ Starting auto deployment..."  # è¾“å‡ºå¼€å§‹æç¤ºä¿¡æ¯

# å¼ºåˆ¶æ£€å‡ºä»£ç åˆ°å·¥ä½œç›®å½•ï¼ˆ--work-tree æŒ‡å®šå·¥ä½œåŒºï¼Œ--git-dir æŒ‡å®šä»“åº“ä½ç½®ï¼‰
git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f

# åˆ‡æ¢åˆ°å·¥ä½œç›®å½•ï¼ˆå‡†å¤‡æ‰§è¡Œæ„å»ºå‘½ä»¤ï¼‰
cd $TARGET

# å®‰è£…ä¾èµ–ï¼ˆ--frozen-lockfile è¡¨ç¤ºä¸¥æ ¼ä½¿ç”¨ lock æ–‡ä»¶ç‰ˆæœ¬ï¼Œé¿å…ç‰ˆæœ¬å†²çªï¼‰
pnpm install --frozen-lockfile

# æ‰§è¡Œæ„å»ºå‘½ä»¤ï¼ˆæ ¹æ®é¡¹ç›®é…ç½®ï¼Œç”Ÿæˆ dist/ ç›®å½•ï¼‰
pnpm run build

# æ¸…ç†æ—§çš„éƒ¨ç½²æ–‡ä»¶ï¼ˆé¿å…æ®‹ç•™æ–‡ä»¶å¹²æ‰°ï¼‰
sudo rm -rf $DEPLOY_DIR/*

# é€’å½’å¤åˆ¶æ„å»ºç»“æœåˆ° Nginx ç›®å½•ï¼ˆ-a å‚æ•°ä¿ç•™æ–‡ä»¶å±æ€§ï¼‰
sudo cp -a dist/* $DEPLOY_DIR/

# ä¿®æ”¹éƒ¨ç½²ç›®å½•æ‰€æœ‰æƒï¼ˆå‡è®¾ Nginx ä»¥ www-data ç”¨æˆ·è¿è¡Œï¼‰
# sudo chown -R root $DEPLOY_DIR

echo "âœ… Deployment completed! Nginx content updated."  # è¾“å‡ºå®Œæˆæç¤º

# æ£€æŸ¥é…ç½®è¯­æ³•
if ! sudo nginx -t; then
  echo "âŒ Nginx é…ç½®æµ‹è¯•å¤±è´¥ï¼Œæ‹’ç»é‡è½½" >&2
  exit 1
fi

# æ‰§è¡Œé‡è½½
sudo nginx -s reload
echo "ğŸ”„ Nginx å·²å¹³æ»‘é‡è½½"
```

## æœ€ç»ˆå®è·µ

> è¿™é‡Œä¸ºäº†~~å‡å°‘æˆ‘çš„å·¥ä½œé‡~~æ–‡ç« ç®€æ´ï¼Œå…ˆå‡è®¾è¯»è€…å·²ç»åœ¨æœåŠ¡å™¨ä¸Šå‡†å¤‡å¥½äº†éƒ¨ç½²ç¯å¢ƒï¼Œå…·ä½“æ¥è¯´å°±æ˜¯æ­è®¾èµ· nginx æœåŠ¡å™¨ï¼›å‡†å¤‡å¥½äº†åšå®¢çš„æ„å»ºç¯å¢ƒï¼ˆpnpmï¼‰

åœ¨æœ¬åœ° PC ä¸Šï¼Œæ·»åŠ ä¸€ç¯‡åšæ–‡ï¼Œç„¶åæäº¤

```bash
git add .
git commit -m "ä½ å¯¹æœ¬æ¬¡æäº¤çš„æè¿°"
```

ç”±äºé‡‡ç”¨ GitHub Pages ä¸ä¸ªäººæœåŠ¡å™¨åŒéƒ¨ç½²ï¼Œä¸ºäº†å‡å°‘å¿ƒç¥æŸè€—ï¼Œå»ºè®®å†™ä¸ªç®€å•çš„è„šæœ¬å®ç°è¿™ä¸€æ­¥ã€‚ç”¨ Windows å¼€å‘å°±å†™ä¸ª `deploy.bat` ï¼Œç”¨ Linux å°±å†™ä¸ª `deploy.sh`

```
# è¿™é‡Œå‡è®¾å·²ç»åˆ†åˆ«ä¸ºæœ¬åœ°ä»“åº“ç»‘å®šäº† GitHub ä»“å’Œä¸ªäººè¿œç¨‹ä»“
# æŸ¥çœ‹è¿œç¨‹ä»“åº“ç»‘å®šæƒ…å†µ
# git remote -v
# GitHub ä»“
# origin  git@github.com:liyuier/liyuier.github.io.git (fetch)
# origin  git@github.com:liyuier/liyuier.github.io.git (push)
# ä¸ªäººè¿œç¨‹ä»“
# yuier   git@yuier.com:/home/git/repos/liyuier.github.io.git (fetch)
# yuier   git@yuier.com:/home/git/repos/liyuier.github.io.git (push)
```

```bash [deploy.bat / deploy.sh]
# åæ­£åšå®¢åªæœ‰è‡ªå·±ä¸€ä¸ªäººå¼€å‘ï¼Œç›´æ¥ push -f 
# å…·ä½“æ¨é€çš„åˆ†æ”¯ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œå¹¶ç›¸åº”å¤„ç† GitHub å·¥ä½œæµæ–‡ä»¶ä¸ä¸Šé¢çš„ git hook è„šæœ¬
# æˆ‘è¿™é‡Œæ‡’å¾—æŠ˜è…¾ï¼Œç›´æ¥æ¨ä¸»åˆ†æ”¯ï¼Œåæ­£å°±ä¸€ä¸ªè‡ªå·±ç”¨çš„åšå®¢
git push -f origin master
git push -f yuier master
```

æ‰§è¡Œè„šæœ¬åï¼Œæ¨é€åˆ° GitHub ä»“ä¼šæ¯”è¾ƒå¿«ï¼›è€Œæ¨é€åˆ°ä¸ªäººä»“ï¼Œç”±äºéœ€è¦æ‰§è¡Œ git hook è„šæœ¬è¿›è¡Œæ„å»ºä¸éƒ¨ç½²ï¼Œä¼šç¨å¾®å¡ä¸€ä¼šï¼Œè€å¿ƒç­‰å¾…å°±å¥½ã€‚

ç­‰å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œå°±å¯ä»¥åœ¨æµè§ˆå™¨é‡Œè¾“å…¥ `<ä½ çš„ nginx æœåŠ¡åœ°å€>` è®¿é—®ç½‘ç«™äº†ã€‚å¦‚æœéƒ¨ç½²æœ‰é—®é¢˜ï¼Œå°±å¯ä»¥å» git hook ä¸­é…ç½®çš„æ—¥å¿—æ–‡ä»¶ `/home/git/logs/blog_deploy.log` ä¸­æŸ¥çœ‹è¯¦æƒ…ã€‚

![image.png](https://s2.loli.net/2025/03/11/PcqsQJvOKZXAkgE.png)

## é™„å½•

å…³äº nginx æœåŠ¡çš„æ­å»ºï¼Œå…¶å®å¯è®²å¯ä¸è®²ï¼Œå› ä¸ºç½‘ä¸Šçš„ç›¸å…³æ–‡ç« å¤ªå¤šäº†ï¼Œå†™å¾—å¥½çš„ä¹Ÿå¾ˆå¤šï¼Œæˆ‘æ— æ„å†æ·»æ— è¶³è½»é‡çš„ä¸€ç¬”ã€‚è¿™é‡ŒåªæŒ‘ä¸€äº›åˆ«äººå†™å¾—å°‘çš„ä¸œè¥¿è®°å½•ä¸‹æ¥ã€‚

### åŸŸåè§£æã€æœåŠ¡å¤‡æ¡ˆ

ä¸€èˆ¬çš„äº‘æœåŠ¡å•†éƒ½ä¼šå¯¹è¿™ä¸¤å—æä¾›è¯¦ç»†çš„å¼•å¯¼ï¼Œè·Ÿç€åšå°±è¡Œäº†ã€‚æˆ‘ç”¨çš„æ˜¯è…¾è®¯äº‘ï¼Œä¸ªäººæ„Ÿè§‰é™¤äº†å¤‡æ¡ˆæœ¬èº«çš„ç¹çå¤–æ²¡é‡åˆ°ä»€ä¹ˆç‰™ç™½çš„äº‹æƒ…ã€‚

### SSL è¯ä¹¦çš„ç”³è¯·ä¸é…ç½®

ç”³è¯·åŒæ ·åœ¨è…¾è®¯äº‘ä¸Šä¸€ç«™å¼è¾¾æˆã€‚è…¾è®¯äº‘ç°åœ¨ï¼ˆ2025 å¹´ 3 æœˆï¼‰å¯ä»¥å…è´¹ç”³è¯· 50 ä¸ªè¯ä¹¦ï¼Œæ¯ä¸ªè¯ä¹¦æœ‰æ•ˆæœŸ 90 å¤©ï¼Œå¤Ÿç”¨å¾ˆä¹…å¾ˆä¹…çš„äº†ã€‚

ç”³è¯·å®Œåï¼Œå¯ä»¥å‚è€ƒ [è¯ä¹¦å®‰è£…](https://cloud.tencent.com/document/product/400/35244#.E8.AF.81.E4.B9.A6.E5.AE.89.E8.A3.85) è¿™ä¸ªåœ°æ–¹åœ¨ nginx æœåŠ¡ä¸‹é…ç½®ã€‚

### æœ€åè´´ä¸€ä¸‹æˆ‘çš„ nginx.conf

```nginx [/etc/nginx/nginx.conf]
#è¿è¡Œç”¨æˆ·ï¼Œé»˜è®¤å°±æ˜¯ www-data ç»„ä¸‹çš„ www-data
user www-data www-data;

#å¯åŠ¨è¿›ç¨‹,é€šå¸¸è®¾ç½®æˆå’Œcpuçš„æ•°é‡ç›¸ç­‰
worker_processes 2;

#å…¨å±€é”™è¯¯æ—¥å¿—
error_log  /usr/share/nginx/logs/error.log;
error_log  /usr/share/nginx/logs/notice.log  notice;
error_log  /usr/share/nginx/logs/info.log  info;

#PIDæ–‡ä»¶ï¼Œè®°å½•å½“å‰å¯åŠ¨çš„nginxçš„è¿›ç¨‹ID
pid        /run/nginx.pid;

#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™
events {
    worker_connections 1024;    #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°
}

#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒ
http {

    # è¿™ä¸€å¨æ¥è‡ªè…¾è®¯äº‘æ¨èé…ç½®
    # æ–°å¢ HTTPS ä¼˜åŒ–é…ç½®
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 5m;
    ssl_protocols TLSv1.2 TLSv1.3;  # ç¦ç”¨æ—§ç‰ˆåè®®
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;
    ssl_prefer_server_ciphers on;

    # å…¨å±€å¼€å¯æ–‡ä»¶æŒ‡çº¹éªŒè¯
    etag on;    

    #è®¾å®šmimeç±»å‹(é‚®ä»¶æ”¯æŒç±»å‹),ç±»å‹ç”±mime.typesæ–‡ä»¶å®šä¹‰
    include       /usr/share/nginx/conf/mime.types;
    default_type  application/octet-stream;

    #è®¾å®šæ—¥å¿—
        log_format  main  '[$remote_addr] - [$remote_user] [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log    /usr/share/nginx/logs/access.log main;
    rewrite_log     on;

    #sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œ
    #å¿…é¡»è®¾ä¸º on,å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI/Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.
    sendfile        on;
    #tcp_nopush     on;

    #è¿æ¥è¶…æ—¶æ—¶é—´
    keepalive_timeout  120;
    tcp_nodelay        on;

        #gzipå‹ç¼©å¼€å…³
        #gzip  on;

    #è®¾å®šå®é™…çš„æœåŠ¡å™¨åˆ—è¡¨
    #upstream zp_server1{
    #    server 127.0.0.1:8089;
    #}

    # å¼ºåˆ¶ HTTP è·³è½¬ HTTPSï¼ˆé‡è¦ï¼ï¼‰
    server {
        listen 80;
        server_name yuier.com;

        # 301 æ°¸ä¹…é‡å®šå‘
        return 301 https://$host$request_uri;
    }

    #HTTPSæœåŠ¡å™¨
    server {

        listen 443 ssl http2;  # å¯ç”¨ HTTP/2
        server_name yuier.com;
        
        # SSL è¯ä¹¦é…ç½®ï¼ˆè¯·ä¿®æ”¹ä¸ºä½ çš„å®é™…è·¯å¾„ï¼‰
        ssl_certificate /usr/share/nginx/ssl/yuier.com_bundle.crt;  # è¯ä¹¦é“¾æ–‡ä»¶
        ssl_certificate_key /usr/share/nginx/ssl/yuier.com.key;  # ç§é’¥æ–‡ä»¶

        # å¯ç”¨ OCSP Stapling æå‡æ€§èƒ½
        ssl_stapling on;
        ssl_stapling_verify on;
        resolver 8.8.8.8 1.1.1.1 valid=300s;
        resolver_timeout 5s;

        # å®‰å…¨å“åº”å¤´
        add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;

        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        index index.html;

        location / {
            # content location
            # root /app;
            root /usr/share/nginx/html;
    
            # exact matches -> reverse clean urls -> folders -> not found
            try_files $uri $uri.html $uri/ =404;

            # non existent pages
            error_page 404 /404.html;

            # a folder without index.html raises 403 in this setup
            error_page 403 /404.html;

            # adjust caching headers
            # files in the assets folder have hashes filenames
            location ~* ^/assets/ {
                expires 1y;
                add_header Cache-Control "public, immutable";
            }
        }
    }
}
```

ä¸Šé¢æåˆ°äº† `mime.types` æ–‡ä»¶ï¼Œç®€å•è¯´å°±æ˜¯é…ç½®å¯¹äºä¸åŒæ–‡ä»¶ç±»å‹çš„è¯·æ±‚çš„å“åº”ã€‚ä¸‹é¢æ˜¯æˆ‘çš„è¯¥æ–‡ä»¶å†…å®¹ï¼š

``` [mime.types]
types {
    text/html                             html htm shtml;
    text/css                              css;
    text/xml                              xml;
    image/gif                             gif;
    image/jpeg                            jpeg jpg;
    application/javascript                js;
    application/atom+xml                  atom;
    application/rss+xml                   rss;

    text/mathml                           mml;
    text/plain                            txt;
    text/vnd.sun.j2me.app-descriptor      jad;
    text/vnd.wap.wml                      wml;
    text/x-component                      htc;

    image/png                             png;
    image/tiff                            tif tiff;
    image/vnd.wap.wbmp                    wbmp;
    image/x-icon                          ico;
    image/x-jng                           jng;
    image/x-ms-bmp                        bmp;
    image/svg+xml                         svg svgz;
    image/webp                            webp;

    application/font-woff                 woff;
    application/java-archive              jar war ear;
    application/json                      json;
    application/mac-binhex40              hqx;
    application/msword                    doc;
    application/pdf                       pdf;
    application/postscript                ps eps ai;
    application/rtf                       rtf;
    application/vnd.apple.mpegurl         m3u8;
    application/vnd.ms-excel              xls;
    application/vnd.ms-fontobject         eot;
    application/vnd.ms-powerpoint         ppt;
    application/vnd.wap.wmlc              wmlc;
    application/vnd.google-earth.kml+xml  kml;
    application/vnd.google-earth.kmz      kmz;
    application/x-7z-compressed           7z;
    application/x-cocoa                   cco;
    application/x-java-archive-diff       jardiff;
    application/x-java-jnlp-file          jnlp;
    application/x-makeself                run;
    application/x-perl                    pl pm;
    application/x-pilot                   prc pdb;
    application/x-rar-compressed          rar;
    application/x-redhat-package-manager  rpm;
    application/x-sea                     sea;
    application/x-shockwave-flash         swf;
    application/x-stuffit                 sit;
    application/x-tcl                     tcl tk;
    application/x-x509-ca-cert            der pem crt;
    application/x-xpinstall               xpi;
    application/xhtml+xml                 xhtml;
    application/xspf+xml                  xspf;
    application/zip                       zip;

    application/octet-stream              bin exe dll;
    application/octet-stream              deb;
    application/octet-stream              dmg;
    application/octet-stream              iso img;
    application/octet-stream              msi msp msm;

    application/vnd.openxmlformats-officedocument.wordprocessingml.document    docx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet          xlsx;
    application/vnd.openxmlformats-officedocument.presentationml.presentation  pptx;

    audio/midi                            mid midi kar;
    audio/mpeg                            mp3;
    audio/ogg                             ogg;
    audio/x-m4a                           m4a;
    audio/x-realaudio                     ra;

    video/3gpp                            3gpp 3gp;
    video/mp2t                            ts;
    video/mp4                             mp4;
    video/mpeg                            mpeg mpg;
    video/quicktime                       mov;
    video/webm                            webm;
    video/x-flv                           flv;
    video/x-m4v                           m4v;
    video/x-mng                           mng;
    video/x-ms-asf                        asx asf;
    video/x-ms-wmv                        wmv;
    video/x-msvideo                       avi;
}
```

## ä»¥ nginx éƒ¨ç½²

(To be done...)