import{_ as o}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CF3jKIAV.js";import{d as g,a as y,u}from"./chunks/vue-router.0fijYp3S.js";import{a2 as D,a3 as l,a4 as e,a5 as s,a6 as i,a7 as A,B as F,a1 as c,D as m}from"./framework.CL_twgqk.js";import"./app.DJJRq6_7.js";import"./chunks/dayjs.BFInjCTz.js";import"./chunks/vue-i18n.CRimy4L_.js";import"./chunks/pinia.KHo6empO.js";/* empty css                    */import"./chunks/@vueuse/motion.DON3upiQ.js";import"./chunks/nprogress.DUFFUuWH.js";import"./YunComment.vue_vue_type_style_index_0_lang.lpZGJo7w.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.7-8ddEp8.js";import"./post.D4SLBNdn.js";const f=g("/posts/006-Jackson-deserializes-auto-adapt-subclasses",async n=>JSON.parse('{"title":"使用 Jackson 反序列化自动适配子类","titleTemplate":"%s - yuier","description":"","frontmatter":{"title":"使用 Jackson 反序列化自动适配子类","titleTemplate":"%s - yuier","date":"2025-03-26 23:56:28","updated":"2025-03-26 23:56:28","author":"yuier","cover":null,"hide":true},"headers":[],"relativePath":"pages/posts/006-Jackson-deserializes-auto-adapt-subclasses.md","lastUpdated":1772277401000}'),{lazy:(n,k)=>n.name===k.name}),I={__name:"006-Jackson-deserializes-auto-adapt-subclasses",setup(n,{expose:k}){const{data:p}=f(),r=u(),E=y(),h=Object.assign(E.meta.frontmatter||{},p.value?.frontmatter||{});return r.currentRoute.value.data=p.value,m("valaxy:frontmatter",h),globalThis.$frontmatter=h,k({frontmatter:{title:"使用 Jackson 反序列化自动适配子类",titleTemplate:"%s - yuier",date:"2025-03-26 23:56:28",updated:"2025-03-26 23:56:28",author:"yuier",cover:null,hide:!0}}),(t,a)=>{const d=o;return c(),D(d,{frontmatter:F(h)},{"main-content-md":l(()=>[a[0]||(a[0]=s("p",null,[i("本文采用方法完全来自于 "),s("a",{href:"https://zhuanlan.zhihu.com/p/357911357",target:"_blank",rel:"noreferrer"},"10 分钟轻松学会 Jackson 反序列化自动适配子类"),i(" ；本文仅补充笔者实践部分工作。")],-1)),A(" more "),a[1]||(a[1]=s("p",null,[s("strong",null,"无法解决多层级父子类反序列化问题，本文暂不发布")],-1)),a[2]||(a[2]=s("h2",{id:"问题引入",tabindex:"-1"},[i("问题引入 "),s("a",{class:"header-anchor",href:"#问题引入","aria-label":'Permalink to "问题引入"'},"​")],-1)),a[3]||(a[3]=s("p",null,[i("我一直在开发一款 QQ 机器人服务端程序项目，该项目适配 "),s("a",{href:"https://283375.github.io/onebot_v11_vitepress/",target:"_blank",rel:"noreferrer"},"OneBot 11 标准"),i(" ; 我的问题就是这个标准中的 "),s("a",{href:"https://283375.github.io/onebot_v11_vitepress/event/index.html",target:"_blank",rel:"noreferrer"},"事件"),i(" 上报机制引入的。")],-1)),a[4]||(a[4]=s("p",null,[i("关于 QQ 机器人比较详细的科普（其实也没有很详细），可以参考我的 "),s("a",{href:"https://yuier.com/posts/003-qq-bot-brief-introduce",target:"_blank",rel:"noreferrer"},"QQ 机器人漫谈"),i(" ; 直入正题地说呢，OneBot 标准定义了一个 "),s("code",null,"客户端"),i(" 和一个 "),s("code",null,"服务端"),i(" 配合提供 QQ 机器人服务；其中客户端用于模拟官方 QQ 客户端，与 QQ 服务器通信，并向服务端上报诸如每条聊天记录、加群退群、禁言、好友申请等一系列消息，服务端处理这些消息，并操作客户端，实现完整的 QQ 机器人服务。")],-1)),a[5]||(a[5]=s("p",null,[i("客户端向服务端上报的这些消息，在 OneBot 标准中被统一整合为 "),s("code",null,"事件"),i(" . 原文：")],-1)),a[6]||(a[6]=s("blockquote",null,[s("p",null,"事件是用户需要从 OneBot 被动接收的数据，有以下几个大类："),s("ul",null,[s("li",null,"消息事件，包括私聊消息、群消息等"),s("li",null,"通知事件，包括群成员变动、好友变动等"),s("li",null,"请求事件，包括加群请求、加好友请求等"),s("li",null,"元事件，包括 OneBot 生命周期、心跳等")]),s("p",null,"在所有能够推送事件的通信方式中（HTTP POST、正向和反向 WebSocket），事件都以 JSON 格式表示。")],-1)),a[7]||(a[7]=s("p",null,"然后坑爹的事情就来了：按道理，这么多不同类型的事件，应该以 URL 区分，上报到服务端不同接口进行处理，这样服务端程序才好编写，业务也好隔离；但是 OneBot 不这样，他规定所有事件全部打到一个接口里，然后以某个字段进行区分。",-1)),a[8]||(a[8]=s("p",null,"自然，事件内部还细分事件；比如消息事件就细分为群聊消息和私聊消息；群聊消息又分为匿名和非匿名；每个事件里还有子事件。。。总之乱得一比，我不知道当年 CQHTTP 插件的作者是在什么样的精神状态下设计出这样一套协议的。",-1)),a[9]||(a[9]=s("p",null,[i("但是总归这个协议现在是最普及的 QQ 机器人协议，我又选择了 "),s("s",null,"SpringBoot"),i(" Java 这种强类型静态语言开发我的服务端程序，于是硬着头皮上了。")],-1)),a[10]||(a[10]=s("p",null,[i("我预期的效果是：在 Controller 层，收到报文后，能够自动反序列化请求体为具体的子类型。比如收到一个群聊消息的报文，就自动反序列化为 "),s("code",null,"GroupMessageEvent"),i(" 对象；而不必手动地从最顶端的 "),s("code",null,"OneBotEvent"),i(" 对象，先转成 "),s("code",null,"MessageEvent"),i(" ，再转成 "),s("code",null,"GroupMessageEvent"),i(" …")],-1)),a[11]||(a[11]=s("p",null,[i("为了实现这一目标，我检索了很多博客，终于给我找着一个解决方案，就是本文开头给出的文章链接: "),s("a",{href:"https://zhuanlan.zhihu.com/p/357911357",target:"_blank",rel:"noreferrer"},"10 分钟轻松学会 Jackson 反序列化自动适配子类"),i(" .")],-1)),a[12]||(a[12]=s("h2",{id:"思路",tabindex:"-1"},[i("思路 "),s("a",{class:"header-anchor",href:"#思路","aria-label":'Permalink to "思路"'},"​")],-1)),a[13]||(a[13]=s("p",null,[i("其实就是基于 SpringBoot 默认的反序列化框架 "),s("code",null,"Jackson"),i(" 实现的，具体来讲，主要有以下几步：")],-1)),a[14]||(a[14]=s("ul",null,[s("li",null,[s("p",null,[i("在父类上加入注解 "),s("code",null,"JsonTypeInfo"),i(" ，指定以某个字段，例如 "),s("code",null,"key"),i(" 的值决定具体适配哪个子类。")])]),s("li",null,[s("p",null,[i("在子类上增加一个自定义的注解，比如可以命名为 "),s("code",null,"JsonTypeDefine"),i(" ，该注解用于注明当父类的 "),s("code",null,"key"),i(" 字段为何值时，应映射为当前子类。")])]),s("li",null,[s("p",null,"上一步只是我们的预期效果，实际上当然不会仅仅因为我们加一个自定义的注解, Jackson 就能自动把子类和 key 字段值关联起来。因此，需要在系统初始化时，增加这样一个关联的流程。对于 SpringBoot 项目，可以定义一个 listener 用于完成该流程。")])],-1)),a[15]||(a[15]=s("h2",{id:"实现",tabindex:"-1"},[i("实现 "),s("a",{class:"header-anchor",href:"#实现","aria-label":'Permalink to "实现"'},"​")],-1)),a[16]||(a[16]=s("h3",{id:"预期效果",tabindex:"-1"},[i("预期效果 "),s("a",{class:"header-anchor",href:"#预期效果","aria-label":'Permalink to "预期效果"'},"​")],-1)),a[17]||(a[17]=s("p",null,[i("定义一个 OneBot 类，以类中的 "),s("code",null,"postType"),i(" 字段值去解析到不同子类；当该字段值为 "),s("code",null,"message"),i(" 时，解析为 "),s("code",null,"MessageEvent"),i(" ；")],-1)),a[18]||(a[18]=s("p",null,[s("code",null,"MessageEvent"),i(" 同样需要继续解析，以 "),s("code",null,"messageType"),i(" 字段的值去解析到不同子类；当该字段值为 "),s("code",null,"group"),i(" 时，解析为 "),s("code",null,"GroupMessageEvent"),i(" ，当值为 "),s("code",null,"private"),i(" 时，解析为 "),s("code",null,"PrivateMessageEvent")],-1)),a[19]||(a[19]=s("h3",{id:"代码",tabindex:"-1"},[i("代码 "),s("a",{class:"header-anchor",href:"#代码","aria-label":'Permalink to "代码"'},"​")],-1)),a[20]||(a[20]=s("blockquote",null,[s("p",null,[i("为了节省篇幅，只给出关键代码，如上述 "),s("a",{href:"#%E6%80%9D%E8%B7%AF"},"思路"),i(" 小节中提到的关键注解、部分关键字段； 其余非关键代码，如 lombok 相关注解、字段风格映射规则注解 "),s("code",null,"JsonNaming"),i(" 、非关键字段等均不会给出。")])],-1)),a[21]||(a[21]=s("div",{class:"language-java max-h-900px"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.fasterxml.jackson.annotation.JsonTypeInfo;")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// OneBotEvent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"JsonTypeInfo"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"use"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," JsonTypeInfo.Id.NAME,  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用子类名称来自动适配子类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"              property"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "postType"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 指定配置子类型的字段为 postType")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"              defaultImpl"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," OneBotEvent.class,  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 未设置 postType 时默认的解析类型，这里设为 OneBotEvent 本身")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"              visible"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 反序列化时 property 配置的字段是否解析出值放在结果中")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," OneBotEvent"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /**")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * 事件类型。此处用于标注子类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * message：消息事件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * notice：通知事件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * request：请求事件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     * meta_event：元事件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"     */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," String postType;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[22]||(a[22]=s("div",{class:"language-java max-h-900px"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// MessageEvent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"JsonTypeDefine"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"message"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 当 OneBotEvent 的 postType 值为 message 时，解析为本类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"JsonTypeInfo"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"use"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," JsonTypeInfo.Id.NAME,  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 使用子类名称来自动适配子类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        property"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "message_type"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 指定配置子类型的字段为 messageType .")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                                    // 这里用下划线风格是因为要采用实际上报的请求中的字段。")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        defaultImpl"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," MessageEvent.class,  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 未设置 messageType 时默认的解析类型，这里设为 OneBotEvent 本身")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        visible"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 反序列化时 property 配置的字段是否解析出值放在结果中")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MessageEvent"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," OneBotEvent"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { ... }")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[23]||(a[23]=s("div",{class:"language-java max-h-900px"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// GroupMessageEvent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"JsonTypeDefine"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"group"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 当 MessageEvent 的 messageType 值为 group 时，解析为本类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," GroupMessageEvent"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MessageEvent"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { ... }")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[24]||(a[24]=s("div",{class:"language-java max-h-900px"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// PrivateMessageEvent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"@"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"JsonTypeDefine"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"private"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")  "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 当 MessageEvent 的 messageType 值为 private 时，解析为本类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," PrivateMessageEvent"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," MessageEvent"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," { ... }")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[25]||(a[25]=s("div",{class:"language-java max-h-900px"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"java"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.fasterxml.jackson.annotation.JsonTypeInfo;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.fasterxml.jackson.databind.ObjectMapper;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," com.fasterxml.jackson.databind.jsontype.NamedType;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"import"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," org.reflections.Reflections;")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 扫描注册环节。该方法在一个 listener 中使用。")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," improveJacksonDeserialize"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 定义扫描包")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String packageName "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "com.yuier.yuni.common"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Reflections reflections "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Reflections"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(packageName);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    /*")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    * 注册子类型，使用名称建立关联")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 使用开源库 Reflections 扫描 JsonTypeInfo 定义的基类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 这里会扫出来 OneBotEvent 和 MessageEvent")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    Set<Class<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> types "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," reflections."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getTypesAnnotatedWith"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(JsonTypeInfo.class);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 遍历基类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    for"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Class<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> type "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," types) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 使用开源库 Reflections 扫描子类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        Set<Class<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},">> subClazzSet "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Set"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Class"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"<?>>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") reflections."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getSubTypesOf"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(type);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(CollectionUtils."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isEmpty"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(subClazzSet)){")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            continue"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 遍历子类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        for"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Class<"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"?"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"> subClazz "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},":"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," subClazzSet) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 跳过接口和抽象类")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(subClazz."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isInterface"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"||"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Modifier."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isAbstract"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(subClazz."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getModifiers"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"())){")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                continue"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 提取 JsonTypeDefine 注解")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            JsonTypeDefine extendClassDefine "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," subClazz."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getAnnotation"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(JsonTypeDefine.class);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (extendClassDefine "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                continue"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            /*")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            * NamedType(Class<?> clazz, String name) 将一个类与其逻辑名称关联起来")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            * ObjectMapper.registerSubtypes(NamedType... types) ~~黑魔法~~ 完成我们希望的注册效果")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            */")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            objectMapper."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"registerSubtypes"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," NamedType"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(subClazz, extendClassDefine."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"value"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()));")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    System.out."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Done."'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1)),a[26]||(a[26]=s("p",null,"大概就这些了。",-1)),a[27]||(a[27]=s("h2",{id:"效果演示",tabindex:"-1"},[i("效果演示 "),s("a",{class:"header-anchor",href:"#效果演示","aria-label":'Permalink to "效果演示"'},"​")],-1)),a[28]||(a[28]=s("p",null,"如图所示，在 Controller 层，接口入参为 OneBotEvent 类型；而实际收到请求后，该请求被自动解析为了 MessageEvent 类型。",-1)),a[29]||(a[29]=s("figure",null,[s("img",{src:"https://s2.loli.net/2025/04/13/nbrS78tNuO2pXyK.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1))]),"main-header":l(()=>[e(t.$slots,"main-header")]),"main-header-after":l(()=>[e(t.$slots,"main-header-after")]),"main-nav":l(()=>[e(t.$slots,"main-nav")]),"main-content-before":l(()=>[e(t.$slots,"main-content-before")]),"main-content":l(()=>[e(t.$slots,"main-content")]),"main-content-after":l(()=>[e(t.$slots,"main-content-after")]),"main-nav-before":l(()=>[e(t.$slots,"main-nav-before")]),"main-nav-after":l(()=>[e(t.$slots,"main-nav-after")]),comment:l(()=>[e(t.$slots,"comment")]),footer:l(()=>[e(t.$slots,"footer")]),aside:l(()=>[e(t.$slots,"aside")]),"aside-custom":l(()=>[e(t.$slots,"aside-custom")]),default:l(()=>[e(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{I as default,f as usePageData};
