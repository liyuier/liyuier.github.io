import{_ as h}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CF3jKIAV.js";import{_ as m}from"./ValaxyMermaid.vue_vue_type_script_setup_true_lang.CwKS2sag.js";import{d as y,a as b,u as I}from"./chunks/vue-router.0fijYp3S.js";import{a2 as E,a3 as a,a4 as e,a5 as l,a6 as s,P as Z,a8 as W,B as A,a1 as v,D as C}from"./framework.CL_twgqk.js";import"./app.DJJRq6_7.js";import"./chunks/dayjs.BFInjCTz.js";import"./chunks/vue-i18n.CRimy4L_.js";import"./chunks/pinia.KHo6empO.js";/* empty css                    */import"./chunks/@vueuse/motion.DON3upiQ.js";import"./chunks/nprogress.DUFFUuWH.js";import"./YunComment.vue_vue_type_style_index_0_lang.lpZGJo7w.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.7-8ddEp8.js";import"./post.D4SLBNdn.js";const V=y("/posts/020-zookeeper-apply",async t=>JSON.parse('{"title":"Zookeeper 应用场景与实现策略","titleTemplate":"%s - yuier","description":"","frontmatter":{"title":"Zookeeper 应用场景与实现策略","titleTemplate":"%s - yuier","date":"2025-12-18 02:41:18","updated":"2025-12-18 02:41:18","author":"yuier","categories":["zookeeper"],"tags":["zookeeper","分布式","八股文"],"cover":null,"hide":"index"},"headers":[],"relativePath":"pages/posts/020-zookeeper-apply.md","lastUpdated":1772277401000}'),{lazy:(t,r)=>t.name===r.name}),M={__name:"020-zookeeper-apply",setup(t,{expose:r}){const{data:p}=V(),u=I(),k=b(),o=Object.assign(k.meta.frontmatter||{},p.value?.frontmatter||{});return u.currentRoute.value.data=p.value,C("valaxy:frontmatter",o),globalThis.$frontmatter=o,r({frontmatter:{title:"Zookeeper 应用场景与实现策略",titleTemplate:"%s - yuier",date:"2025-12-18 02:41:18",updated:"2025-12-18 02:41:18",author:"yuier",categories:["zookeeper"],tags:["zookeeper","分布式","八股文"],cover:null,hide:"index"}}),(n,i)=>{const d=m,g=h;return v(),E(g,{frontmatter:A(o)},{"main-content-md":a(()=>[i[0]||(i[0]=l("h2",{id:"典型应用",tabindex:"-1"},[s("典型应用 "),l("a",{class:"header-anchor",href:"#典型应用","aria-label":'Permalink to "典型应用"'},"​")],-1)),i[1]||(i[1]=l("ul",null,[l("li",null,[l("p",null,"配置中心")]),l("li",null,[l("p",null,"注册中心")]),l("li",null,[l("p",null,"分布式锁")]),l("li",null,[l("p",null,"分布式队列")]),l("li",null,[l("p",null,"负载均衡")]),l("li",null,[l("p",null,"master 选举")])],-1)),i[2]||(i[2]=l("h2",{id:"配置中心",tabindex:"-1"},[s("配置中心 "),l("a",{class:"header-anchor",href:"#配置中心","aria-label":'Permalink to "配置中心"'},"​")],-1)),i[3]||(i[3]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/17/5BM78trpNHKOZjv.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[4]||(i[4]=l("p",null,"核心功能：和客户端的配置交互，屏蔽不同配置仓库在技术实现上的差异",-1)),i[5]||(i[5]=l("p",null,"实现方式：文件系统、版本控制系统、自定义存储等",-1)),i[6]||(i[6]=l("p",null,"最佳实践：配置管理和 CI/CD 的各项模式和实践",-1)),i[7]||(i[7]=l("p",null,"基于 Zookeeper 实现分布式环境下配置信息共享管理",-1)),i[8]||(i[8]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/17/m1FyCT3R7EnteHA.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[9]||(i[9]=l("h2",{id:"注册中心",tabindex:"-1"},[s("注册中心 "),l("a",{class:"header-anchor",href:"#注册中心","aria-label":'Permalink to "注册中心"'},"​")],-1)),i[10]||(i[10]=l("p",null,"三大角色",-1)),i[11]||(i[11]=l("ul",null,[l("li",null,[l("p",null,"注册中心：服务端角色")]),l("li",null,[l("p",null,"服务提供者：注册中心的客户端")]),l("li",null,[l("p",null,"服务消费者：注册中心的客户端")])],-1)),i[12]||(i[12]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/17/WILSkDARXTKroB5.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[13]||(i[13]=l("p",null,"两大操作：注册操作 + 订阅操作",-1)),i[14]||(i[14]=l("p",null,"关键技术：服务变更通知机制",-1)),i[15]||(i[15]=l("h3",{id:"服务订阅发布流程",tabindex:"-1"},[s("服务订阅发布流程 "),l("a",{class:"header-anchor",href:"#服务订阅发布流程","aria-label":'Permalink to "服务订阅发布流程"'},"​")],-1)),Z(d,W({code:"c2VxdWVuY2VEaWFncmFtCiAgICBwYXJ0aWNpcGFudCBQcm92aWRlcgogICAgcGFydGljaXBhbnQgWm9va2VlcGVyCiAgICBwYXJ0aWNpcGFudCBDb25zdW1lcgoKICAgIE5vdGUgb3ZlciBQcm92aWRlcixab29rZWVwZXI6IDEuIFByb3ZpZGVyIOWIm-W7uuS4jiBaSyDov57mjqUKICAgIFByb3ZpZGVyLT4-Wm9va2VlcGVyOiAxLiBjcmVhdGUgY29ubmVjdGlvbgoKICAgIE5vdGUgb3ZlciBDb25zdW1lcixab29rZWVwZXI6IDIuIENvbnN1bWVyIOWIm-W7uuS4jiBaSyDov57mjqUKICAgIENvbnN1bWVyLT4-Wm9va2VlcGVyOiAyLiBjcmVhdGUgY29ubmVjdGlvbgoKICAgIE5vdGUgb3ZlciBQcm92aWRlcixab29rZWVwZXI6IDMuIFByb3ZpZGVyIOWPkeW4g-acjeWKoeWumuS5iQogICAgUHJvdmlkZXItPj5ab29rZWVwZXI6IDMuIGNyZWF0ZSBlcGhlbWVyYWwgbm9kZTxicj4vc2VydmljZXMvb3JkZXIgLT4gaXA6cG9ydAoKICAgIE5vdGUgb3ZlciBDb25zdW1lcixab29rZWVwZXI6IDQuIENvbnN1bWVyIOiOt-WPluaMh-WumuacjeWKoeWcsOWdgOWIl-ihqAogICAgQ29uc3VtZXItPj5ab29rZWVwZXI6IDQuIGdldENoaWxkcmVuKC9zZXJ2aWNlcy9vcmRlcikKCiAgICBOb3RlIG92ZXIgQ29uc3VtZXIsWm9va2VlcGVyOiA1LiBDb25zdW1lciDnm5HlkKzmnI3liqHlnLDlnYDliJfooagKICAgIENvbnN1bWVyLT4-Wm9va2VlcGVyOiA1LiBhZGRXYXRjaGVyKC9zZXJ2aWNlcy9vcmRlcikKCiAgICBsb29wIOWKqOaAgeazqOWGjOaWsOacjeWKoQogICAgICAgIE5vdGUgb3ZlciBQcm92aWRlcixab29rZWVwZXI6IDYuIFByb3ZpZGVyIOWKqOaAgeazqOWGjOaWsOacjeWKoQogICAgICAgIFByb3ZpZGVyLT4-Wm9va2VlcGVyOiA2LiBjcmVhdGUgZXBoZW1lcmFsIG5vZGUKICAgIGVuZAoKICAgIE5vdGUgb3ZlciBDb25zdW1lcixab29rZWVwZXI6IDcuIENvbnN1bWVyIOiOt-WPluabtOaWsOWQjueahOacjeWKoeWIl-ihqAogICAgWm9va2VlcGVyLS0-PkNvbnN1bWVyOiA3LiB3YXRjaGVyIHRyaWdnZXJlZCDihpIgZ2V0Q2hpbGRyZW4gYWdhaW4KCiAgICBOb3RlIG92ZXIgUHJvdmlkZXIsWm9va2VlcGVyOiA4LiBQcm92aWRlciDlj5bmtojlt7Llj5HluIPmnI3liqHvvIjkuIvnur_vvIkKICAgIFpvb2tlZXBlci0-Plpvb2tlZXBlcjogOC4gZXBoZW1lcmFsIG5vZGUgYXV0byBkZWxldGVkIChzZXNzaW9uIGV4cGlyZWQpCgogICAgTm90ZSBvdmVyIENvbnN1bWVyLFpvb2tlZXBlcjogOS4gQ29uc3VtZXIg6I635Y-W5Yig6Zmk5ZCO55qE5pyN5Yqh5YiX6KGoCiAgICBab29rZWVwZXItLT4-Q29uc3VtZXI6IDkuIHdhdGNoZXIgdHJpZ2dlcmVkIOKGkiBnZXRDaGlsZHJlbiBhZ2FpbgoKICAgIGxvb3Ag5b-D6Lez57u05oyB5Lya6K-dCiAgICAgICAgUHJvdmlkZXItPj5ab29rZWVwZXI6IDEwLiBoZWFydGJlYXQKICAgICAgICBDb25zdW1lci0-Plpvb2tlZXBlcjogMTEuIGhlYXJ0YmVhdAogICAgZW5k"},{}),null,16),i[16]||(i[16]=l("h3",{id:"变更通知机制",tabindex:"-1"},[s("变更通知机制 "),l("a",{class:"header-anchor",href:"#变更通知机制","aria-label":'Permalink to "变更通知机制"'},"​")],-1)),i[17]||(i[17]=l("p",null,"消费者通过 watcher 机制监控服务配置状态",-1)),i[18]||(i[18]=l("h3",{id:"zookeeper-与-dubbo",tabindex:"-1"},[s("zookeeper 与 dubbo "),l("a",{class:"header-anchor",href:"#zookeeper-与-dubbo","aria-label":'Permalink to "zookeeper 与 dubbo"'},"​")],-1)),i[19]||(i[19]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/18/u9e54BsFxikcJWl.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[20]||(i[20]=l("ul",null,[l("li",null,[l("p",null,"服务容器负责启动、加载、运行服务提供者")]),l("li",null,[l("p",null,"服务提供者在启动时向注册中心注册自己提供的服务")]),l("li",null,[l("p",null,"服务消费者在启动时向注册中心订阅自己需要的服务")]),l("li",null,[l("p",null,"注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者")]),l("li",null,[l("p",null,"服务消费者从提供者地址列表中选一台提供者进行调用")])],-1)),i[21]||(i[21]=l("p",null,"总结",-1)),i[22]||(i[22]=l("ul",null,[l("li",null,[l("p",null,"注册中心负责服务地址的注册与查找（目录服务）")]),l("li",null,[l("p",null,"服务提供者向注册中心注册其提供的服务")]),l("li",null,[l("p",null,"服务消费者向注册中心获取服务提供者地址列表")]),l("li",null,[l("p",null,"注册中心、提供者、消费者三者之间均为长连接")]),l("li",null,[l("p",null,"注册中心感知提供者宕机并推送事件通知消费者")]),l("li",null,[l("p",null,"注册中心宕机，消费者使用本地缓存提供者列表")])],-1)),i[23]||(i[23]=l("h2",{id:"分布式锁",tabindex:"-1"},[s("分布式锁 "),l("a",{class:"header-anchor",href:"#分布式锁","aria-label":'Permalink to "分布式锁"'},"​")],-1)),i[24]||(i[24]=l("p",null,"不同的分布式锁的实现方案",-1)),i[25]||(i[25]=l("ul",null,[l("li",null,[l("p",null,"关系型数据库"),l("p",null,[s("直接使用数据库的 "),l("code",null,"select ... for update"),s(" 机制和数据版本机制来分别实现悲观锁和乐观锁")])]),l("li",null,[l("p",null,"zookeeper 和 curator"),l("p",null,"zk 提供了一整套完整的分布式锁方案。 curator 在 zk 的基础上进行了封装，实现了即插即用的分布式读写锁")]),l("li",null,[l("p",null,"redis 和 redisson"),l("p",null,"redis 底层提供了分布式锁的实现能力，而 redisson 是一款基于 reids 实现的 java 分布式对象和服务的框架，提供了多种分布式锁的实现方式")])],-1)),i[26]||(i[26]=l("p",null,"zookeeper 基本结构",-1)),i[27]||(i[27]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/18/c9eLfsGVUbdFRvX.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[28]||(i[28]=l("h3",{id:"zk-实现分布式锁方案",tabindex:"-1"},[s("zk 实现分布式锁方案 "),l("a",{class:"header-anchor",href:"#zk-实现分布式锁方案","aria-label":'Permalink to "zk 实现分布式锁方案"'},"​")],-1)),i[29]||(i[29]=l("ul",null,[l("li",null,[l("p",null,"临时节点"),l("p",null,"所有访问 zk 的客户端都会注册为节点")]),l("li",null,[l("p",null,"全局事务ID"),l("p",null,"每个节点在创建时都会生成一个唯一的递增序列号")]),l("li",null,[l("p",null,"顺序访问"),l("p",null,"客户端获取节点列表并排序，如果自己节点的编号最小则获得锁")]),l("li",null,[l("p",null,"监听机制"),l("p",null,"反之监听排在自己前面的节点，如果监听到该节点被删除则重新执行排序")])],-1)),i[30]||(i[30]=l("h3",{id:"代码演示",tabindex:"-1"},[s("代码演示 "),l("a",{class:"header-anchor",href:"#代码演示","aria-label":'Permalink to "代码演示"'},"​")],-1)),i[31]||(i[31]=l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," doLock"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(CuratorFramework client){")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    String CURATOR_LOCK "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "/curatorLock"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"; "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"//Zookeeper中的锁节点")]),s(`
`),l("span",{class:"line"}),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 实例化分布式锁：可重入锁")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    InterProcessMutex lock "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," InterProcessMutex"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(client, CURATOR_LOCK);")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    try"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 判断是否获取到了zk分布式锁")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"acquire"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"5"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", TimeUnit.SECONDS)){  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 最多等待 5 秒，如果超时仍未获取到锁，则返回 false           ")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 业务操作                ")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Exception "),l("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        e."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"printStackTrace"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 释放锁")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isOwnedByCurrentThread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"release"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),s(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),i[32]||(i[32]=l("h3",{id:"更完整的代码示例",tabindex:"-1"},[s("更完整的代码示例 "),l("a",{class:"header-anchor",href:"#更完整的代码示例","aria-label":'Permalink to "更完整的代码示例"'},"​")],-1)),i[33]||(i[33]=l("p",null,[s("见 "),l("a",{href:"https://github.com/liyuier/zhuawa-zookeeper-curator",target:"_blank",rel:"noreferrer"},"https://github.com/liyuier/zhuawa-zookeeper-curator")],-1)),i[34]||(i[34]=l("h3",{id:"interprocessmutex-与-interprocesssemaphoremutex",tabindex:"-1"},[s("InterProcessMutex 与 InterProcessSemaphoreMutex "),l("a",{class:"header-anchor",href:"#interprocessmutex-与-interprocesssemaphoremutex","aria-label":'Permalink to "InterProcessMutex 与 InterProcessSemaphoreMutex"'},"​")],-1)),i[35]||(i[35]=l("ul",null,[l("li",null,[l("p",null,"InterProcessMutex"),l("p",null,"排他锁，同一时刻，只能由一个客户端持有锁。"),l("p",null,"适用严格的串行执行场景：定时任务调度、库存扣减、数据迁移等")]),l("li",null,[l("p",null,"InterProcessSemaphoreMutex"),l("p",null,"信号量锁，同一时刻，最多 N 个客户端可以持有锁（N 由 maxLeases 参数指定）"),l("p",null,"适用有限并发控制场景：数据库连接池、API 调用限流、批量任务并发控制")])],-1)),i[36]||(i[36]=l("h3",{id:"分布式锁选型",tabindex:"-1"},[s("分布式锁选型 "),l("a",{class:"header-anchor",href:"#分布式锁选型","aria-label":'Permalink to "分布式锁选型"'},"​")],-1)),i[37]||(i[37]=l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/18/S4pJILZ5RHkqsnY.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),i[38]||(i[38]=l("p",null,"对于可靠性要求较高的场景，优先选择 zk 实现分布式锁",-1)),i[39]||(i[39]=l("h4",{id:"cap-理论",tabindex:"-1"},[s("CAP 理论 "),l("a",{class:"header-anchor",href:"#cap-理论","aria-label":'Permalink to "CAP 理论"'},"​")],-1)),i[40]||(i[40]=l("ul",null,[l("li",null,[l("p",null,"Consistency"),l("p",null,"一致性：所有节点在同一时间看到的数据完全一致")]),l("li",null,[l("p",null,"Availability"),l("p",null,"可用性：系统对任何有效请求都能在合理时间内给出响应")]),l("li",null,[l("p",null,"Partition Tolerance"),l("p",null,"分区容错性：系统在部分节点间无法通信的情况下仍能继续运行")])],-1)),i[41]||(i[41]=l("p",null,"P 是必须要求的，因此分布式系统需要在 C 和 A 之间取舍。zk 选择的是 CP ，在 Leader 选举过程中，或半数以上的机器不可用等情况下服务不可用；redis 选择的是 AP . spring cloud 选择的也是 AP",-1)),i[42]||(i[42]=l("h2",{id:"高可用架构",tabindex:"-1"},[s("高可用架构 "),l("a",{class:"header-anchor",href:"#高可用架构","aria-label":'Permalink to "高可用架构"'},"​")],-1)),i[43]||(i[43]=l("ul",null,[l("li",null,[l("p",null,"热备方案"),l("p",null,"一个 active master ，若干 standby master"),l("p",null,"当 active master 失效时，从若干 standby master 中挑选一个作为 active master")]),l("li",null,[l("p",null,"共享存储 HA"),l("p",null,"active master 不断写入信息"),l("p",null,"standby master 不断同步信息"),l("p",null,"主备切换时，选中的 standby master 保证信息完全同步之后再切换到 active master")])],-1)),i[44]||(i[44]=l("h3",{id:"yarn-架构",tabindex:"-1"},[s("yarn 架构 "),l("a",{class:"header-anchor",href:"#yarn-架构","aria-label":'Permalink to "yarn 架构"'},"​")],-1)),i[45]||(i[45]=l("p",null,"resource manager",-1)),i[46]||(i[46]=l("ul",null,[l("li",null,[l("p",null,"负责集群中所有资源的统一管理和分配")]),l("li",null,[l("p",null,"接收来自各个节点的资源汇报信息")]),l("li",null,[l("p",null,"吧这些信息按照一定的策略分配给各个应用程序")])],-1)),i[47]||(i[47]=l("p",null,"resource manager HA",-1)),i[48]||(i[48]=l("p",null,"多个 resource manager 共存，其中一个处于 active 状态",-1)),i[49]||(i[49]=l("p",null,"当 Active RM 失效时，处于 standby 的 RM 就会通过竞争选举产生新的 active 节点",-1)),i[50]||(i[50]=l("p",null,"工作模式",-1)),i[51]||(i[51]=l("ol",null,[l("li",null,[l("p",null,"创建锁节点"),l("p",null,"所有的 RM 在启动时，都会去竞争写一个 Lock 子节点，该节点为临时节点"),l("p",null,"zk 保证只有一个 RM 能成功创建。创建成功的那个 RM 就切换为 active 状态，没有成功的则为 standby 状态")]),l("li",null,[l("p",null,"注册 watcher 监听"),l("p",null,"所有的 standby 状态的 RM 节点都会对 active 状态的 RM 节点注册一个节点变更的 watcher 监听，以感知 active 状态的 RM 节点的运行状态")]),l("li",null,[l("p",null,"完成主备切换"),l("p",null,"当 active 状态的 RM 出现诸如宕机或重启的异常情况时，其在 zk 上连接的会话就失效，因此该节点会被删除。"),l("p",null,"此时其余 standby 状态的 RM 就会接收到来自 zk 服务端的 watcher 事件通知，然后会重复步骤 1 的操作")])],-1))]),"main-header":a(()=>[e(n.$slots,"main-header")]),"main-header-after":a(()=>[e(n.$slots,"main-header-after")]),"main-nav":a(()=>[e(n.$slots,"main-nav")]),"main-content-before":a(()=>[e(n.$slots,"main-content-before")]),"main-content":a(()=>[e(n.$slots,"main-content")]),"main-content-after":a(()=>[e(n.$slots,"main-content-after")]),"main-nav-before":a(()=>[e(n.$slots,"main-nav-before")]),"main-nav-after":a(()=>[e(n.$slots,"main-nav-after")]),comment:a(()=>[e(n.$slots,"comment")]),footer:a(()=>[e(n.$slots,"footer")]),aside:a(()=>[e(n.$slots,"aside")]),"aside-custom":a(()=>[e(n.$slots,"aside-custom")]),default:a(()=>[e(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{M as default,V as usePageData};
