import{_ as E}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CF3jKIAV.js";import{d as o,a as c,u as g}from"./chunks/vue-router.0fijYp3S.js";import{a2 as y,a3 as s,a4 as n,a5 as l,a6 as i,B as F,a1 as A,D as m}from"./framework.CL_twgqk.js";import"./app.DJJRq6_7.js";import"./chunks/dayjs.BFInjCTz.js";import"./chunks/vue-i18n.CRimy4L_.js";import"./chunks/pinia.KHo6empO.js";/* empty css                    */import"./chunks/@vueuse/motion.DON3upiQ.js";import"./chunks/nprogress.DUFFUuWH.js";import"./YunComment.vue_vue_type_style_index_0_lang.lpZGJo7w.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.7-8ddEp8.js";import"./post.D4SLBNdn.js";const b=o("/posts/016-base-multithreading",async t=>JSON.parse('{"title":"多线程基础","titleTemplate":"%s - yuier","description":"","frontmatter":{"title":"多线程基础","titleTemplate":"%s - yuier","date":"2025-12-09 18:06:12","updated":"2025-12-09 18:06:12","author":"yuier","categories":["并发编程"],"tags":["并发编程","多线程","Java","八股文"],"cover":null,"hide":"index"},"headers":[],"relativePath":"pages/posts/016-base-multithreading.md","lastUpdated":1772277401000}'),{lazy:(t,h)=>t.name===h.name}),J={__name:"016-base-multithreading",setup(t,{expose:h}){const{data:k}=b(),p=g(),d=c(),e=Object.assign(d.meta.frontmatter||{},k.value?.frontmatter||{});return p.currentRoute.value.data=k.value,m("valaxy:frontmatter",e),globalThis.$frontmatter=e,h({frontmatter:{title:"多线程基础",titleTemplate:"%s - yuier",date:"2025-12-09 18:06:12",updated:"2025-12-09 18:06:12",author:"yuier",categories:["并发编程"],tags:["并发编程","多线程","Java","八股文"],cover:null,hide:"index"}}),(a,r)=>{const u=E;return A(),y(u,{frontmatter:F(e)},{"main-content-md":s(()=>[...r[0]||(r[0]=[l("h2",{id:"线程的概念",tabindex:"-1"},[i("线程的概念 "),l("a",{class:"header-anchor",href:"#线程的概念","aria-label":'Permalink to "线程的概念"'},"​")],-1),l("p",null,"线程是操作系统能够进行运算调度的最小单位，被包含在进程中，是进程中的一个执行实体或控制流",-1),l("ul",null,[l("li",null,[l("p",null,"一个进程可以包含多个线程，它们共享进程的资源")]),l("li",null,[l("p",null,"每个线程拥有独立的栈、程序计数器、寄存器")]),l("li",null,[l("p",null,"线程之间可以并发执行")])],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"对比维度"),l("th",null,"进程（Process）"),l("th",null,"线程（Thread）")])]),l("tbody",null,[l("tr",null,[l("td",null,"资源拥有"),l("td",null,"拥有独立的地址空间和系统资源"),l("td",null,"共享所属进程的资源")]),l("tr",null,[l("td",null,"调度单位"),l("td",null,"是资源分配单位"),l("td",null,"是 CPU 调度的基本单位")]),l("tr",null,[l("td",null,"创建/切换开销"),l("td",null,"开销大"),l("td",null,"开销小（只需创建栈和寄存器上下文）")]),l("tr",null,[l("td",null,"通信方式"),l("td",null,"需要 IPC（管道、消息队列、共享内存等）"),l("td",null,"可直接读写共享内存（需同步机制）")]),l("tr",null,[l("td",null,"稳定性/安全性"),l("td",null,"相互隔离，更安全"),l("td",null,"一个线程崩溃可能导致整个进程崩溃")]),l("tr",null,[l("td",null,"并发性"),l("td",null,"进程间并发"),l("td",null,"线程间并发（更轻量、高效）")])])],-1),l("h3",{id:"私有与共享的资源",tabindex:"-1"},[i("私有与共享的资源 "),l("a",{class:"header-anchor",href:"#私有与共享的资源","aria-label":'Permalink to "私有与共享的资源"'},"​")],-1),l("p",null,"私有资源：",-1),l("ul",null,[l("li",null,[l("p",null,"线程栈：储存局部变量、函数参数、范围地址等，栈溢出只影响该线程")]),l("li",null,[l("p",null,"程序计数器：当前线程正在执行的指令地址")]),l("li",null,[l("p",null,"寄存器集合：通用寄存器、状态寄存器等。线程切换时需要保存/恢复这些寄存器状态")]),l("li",null,[l("p",null,"局部存储")]),l("li",null,[l("p",null,"线程 ID")])],-1),l("p",null,"共享资源",-1),l("ul",null,[l("li",null,[l("p",null,"代码段：程序的可执行指令")]),l("li",null,[l("p",null,"数据段：全局变量、静态变量")]),l("li",null,[l("p",null,"堆：动态分配的内存")]),l("li",null,[l("p",null,"文件描述符、句柄")])],-1),l("h2",{id:"使用线程可能遇到的问题",tabindex:"-1"},[i("使用线程可能遇到的问题 "),l("a",{class:"header-anchor",href:"#使用线程可能遇到的问题","aria-label":'Permalink to "使用线程可能遇到的问题"'},"​")],-1),l("h3",{id:"上下文切换",tabindex:"-1"},[i("上下文切换 "),l("a",{class:"header-anchor",href:"#上下文切换","aria-label":'Permalink to "上下文切换"'},"​")],-1),l("p",null,"当操作系统在多个线程之间切换执行权时，需要保存当前线程的 CPU 状态（寄存器、程序计数器、栈指针等），并恢复下一个线程的状态。",-1),l("ul",null,[l("li",null,[l("p",null,"性能损耗：频繁切换会消耗 CPU 时间，尤其在线程数量远超 CPU 核心数时（如成百上千线程争抢少量核心）。")]),l("li",null,[l("p",null,"缓存失效（Cache Thrashing）：不同线程访问不同内存区域，导致 CPU 缓存频繁失效，降低内存访问效率。")]),l("li",null,[l("p",null,"调度延迟：高并发下调度器负担加重，可能影响实时性或响应时间。")])],-1),l("p",null,"如何减少上下文并发：",-1),l("ul",null,[l("li",null,[l("p",null,"无锁并发")]),l("li",null,[l("p",null,"CAS 算法")]),l("li",null,[l("p",null,"协程")])],-1),l("h3",{id:"线程创建与销毁的开销",tabindex:"-1"},[i("线程创建与销毁的开销 "),l("a",{class:"header-anchor",href:"#线程创建与销毁的开销","aria-label":'Permalink to "线程创建与销毁的开销"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,"创建线程的成本高"),l("ul",null,[l("li",null,[l("p",null,"需分配内核数据结构、初始化栈、设置寄存器状态等")]),l("li",null,[l("p",null,"创建新线程涉及系统调用")]),l("li",null,[l("p",null,"相比进程轻量，但仍比函数或协程重得多")])])]),l("li",null,[l("p",null,"频繁创建/销毁的问题"),l("ul",null,[l("li",null,[l("p",null,"内存碎片")]),l("li",null,[l("p",null,"系统资源耗尽风险")]),l("li",null,[l("p",null,"性能波动大")])])])],-1),l("p",null,"解决方法：使用线程池复用线程，避免重复创建/销毁",-1),l("h3",{id:"死锁",tabindex:"-1"},[i("死锁 "),l("a",{class:"header-anchor",href:"#死锁","aria-label":'Permalink to "死锁"'},"​")],-1),l("p",null,"产生条件",-1),l("ul",null,[l("li",null,[l("p",null,"互斥")]),l("li",null,[l("p",null,"占有并等待")]),l("li",null,[l("p",null,"不可抢占")]),l("li",null,[l("p",null,"循环等待")])],-1),l("p",null,"避免死锁",-1),l("ul",null,[l("li",null,[l("p",null,"避免一个线程同时获取多个锁")]),l("li",null,[l("p",null,"避免一个线程在锁内同时占用多个资源")]),l("li",null,[l("p",null,"尝试使用定时锁")]),l("li",null,[l("p",null,"加锁和解锁必须在一个数据库连接里")])],-1),l("h3",{id:"资源限制",tabindex:"-1"},[i("资源限制 "),l("a",{class:"header-anchor",href:"#资源限制","aria-label":'Permalink to "资源限制"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,"硬件资源限制")]),l("li",null,[l("p",null,"软件资源限制")])],-1),l("p",null,"引发问题",-1),l("ul",null,[l("li",null,[l("p",null,"线程创建失败")]),l("li",null,[l("p",null,"性能下降")])],-1),l("p",null,"如何解决",-1),l("ul",null,[l("li",null,[l("p",null,"线程池")]),l("li",null,[l("p",null,"减小线程栈大小")])],-1),l("p",null,"在资源受限情况下进行并发编程",-1),l("ul",null,[l("li",null,[l("p",null,"使用异步 IO 或协程")]),l("li",null,[l("p",null,"固定大小线程池，与 CPU 核心数量相近")])],-1),l("h2",{id:"线程状态及切换",tabindex:"-1"},[i("线程状态及切换 "),l("a",{class:"header-anchor",href:"#线程状态及切换","aria-label":'Permalink to "线程状态及切换"'},"​")],-1),l("p",null,"Java 中线程存在六种状态",-1),l("figure",null,[l("img",{src:"https://s2.loli.net/2025/12/07/7Dg3bTPmXuKlGvQ.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1),l("ul",null,[l("li",null,[l("p",null,"NEW"),l("p",null,"线程已创建，但未调用 start()")]),l("li",null,[l("p",null,"RUNNABLE"),l("p",null,"线程正在 JVM 中执行（可能在 CPU 上运行，也可能在等待 OS 调度）")]),l("li",null,[l("p",null,"BLOCKED"),l("p",null,"线程等待获取 monitor 锁（即 synchronized 锁）")]),l("li",null,[l("p",null,"WAITING"),l("p",null,"线程无限期等待其他线程显式唤醒")]),l("li",null,[l("p",null,"TIMED_WAITING"),l("p",null,"线程等待有超时时间的操作")]),l("li",null,[l("p",null,"TERMINATED"),l("p",null,"线程执行结束")])],-1),l("h3",{id:"一些函数的区别",tabindex:"-1"},[i("一些函数的区别 "),l("a",{class:"header-anchor",href:"#一些函数的区别","aria-label":'Permalink to "一些函数的区别"'},"​")],-1),l("ul",null,[l("li",null,[l("p",null,"wait"),l("p",null,"必须在 synchronized 方法块内调用"),l("p",null,"使当前线程释放对象的 monitor 锁，进入等待队列"),l("p",null,"等待其他线程调用同一对象的 notify 或 notifyall")]),l("li",null,[l("p",null,"sleep"),l("p",null,"使当前线程暂停指定毫秒数"),l("p",null,"不释放任何锁")]),l("li",null,[l("p",null,"hoin"),l("p",null,"当前线程等待目标线程指定完毕"),l("p",null,"底层通过 wait 实现")]),l("li",null,[l("p",null,"yield"),l("p",null,"当前线程愿意让出 CPU，给其他同优先级或更高优先级的线程运行"),l("p",null,"不保证一定让出"),l("p",null,"不阻塞线程，状态仍是 RUNNABLE")])],-1),l("h2",{id:"线程的启动、中断、终止",tabindex:"-1"},[i("线程的启动、中断、终止 "),l("a",{class:"header-anchor",href:"#线程的启动、中断、终止","aria-label":'Permalink to "线程的启动、中断、终止"'},"​")],-1),l("h3",{id:"启动",tabindex:"-1"},[i("启动 "),l("a",{class:"header-anchor",href:"#启动","aria-label":'Permalink to "启动"'},"​")],-1),l("p",null,[i("使用 "),l("code",null,"start()"),i(" 方法")],-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Thread t "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Thread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(() "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"->"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    System.out."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"线程正在运行"'),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"});")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"t."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ✅ 正确：启动新线程，JVM 调用 run()")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("ul",null,[l("li",null,[l("p",null,"JVM 创建一个新的执行线程")]),l("li",null,[l("p",null,"该线程进入 RUNNABLE 状态（可能立即运行，也可能等待 CPU）")]),l("li",null,[l("p",null,"自动调用 run() 方法")])],-1),l("p",null,"注意",-1),l("ul",null,[l("li",null,[l("p",null,"一个线程只能启动一次。再次调用 start() 会抛出 IllegalThreadStateException")]),l("li",null,[l("p",null,"线程启动后，其生命周期由 JVM 和操作系统共同管理")])],-1),l("h3",{id:"中断",tabindex:"-1"},[i("中断 "),l("a",{class:"header-anchor",href:"#中断","aria-label":'Permalink to "中断"'},"​")],-1),l("p",null,[i("Java 不支持强制终止线程，而是采用 "),l("code",null,"协作式中断机制"),i(" : 通过设置中断标志，由线程自行决定如何响应")],-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"方法"),l("th",null,"作用")])]),l("tbody",null,[l("tr",null,[l("td",null,"thread.interrupt()"),l("td",null,"设置目标线程的中断标志位为 true")]),l("tr",null,[l("td",null,"Thread.interrupted()"),l("td",null,"静态方法：检查当前线程是否被中断，并清除中断状态（返回后标志变 false）")]),l("tr",null,[l("td",null,"thread.isInterrupted()"),l("td",null,"实例方法：检查该线程是否被中断，不清除状态")])])],-1),l("h3",{id:"终止",tabindex:"-1"},[i("终止 "),l("a",{class:"header-anchor",href:"#终止","aria-label":'Permalink to "终止"'},"​")],-1),l("p",null,"Java 没有提供安全的强制终止方法，而是提供了自然终止、协作中断等",-1),l("ul",null,[l("li",null,[l("p",null,"自然终止：任务执行完毕自然终止")]),l("li",null,[l("p",null,"通过中断请求退出"),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Worker"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," extends"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Thread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," run"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Thread."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentThread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isInterrupted"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            try"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 模拟工作")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Thread."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"sleep"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"100"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            } "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"catch"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (InterruptedException "),l("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"e"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"                // 收到中断，退出")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                Thread."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentThread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"interrupt"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 恢复状态")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                break"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"        // 清理资源")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        cleanup"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 外部请求终止")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Worker w "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Worker"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"w."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"start"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ...")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"w."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"interrupt"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 请求中断")])])]),l("button",{class:"code-block-unfold-btn"})])]),l("li",null,[l("p",null,"使用 volatile 标志位 适用于无阻塞循环"),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Task"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," implements"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Runnable"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," boolean"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," running "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," true"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," stop"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        running "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," false"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},";")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    @"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"Override")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," run"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        while"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (running) {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"            // 工作")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})])])],-1),l("h2",{id:"线程间的通信",tabindex:"-1"},[i("线程间的通信 "),l("a",{class:"header-anchor",href:"#线程间的通信","aria-label":'Permalink to "线程间的通信"'},"​")],-1),l("p",null,"多个线程通过共享内存实现信息交换，但需解决以下问题",-1),l("ul",null,[l("li",null,[l("p",null,"可见性"),l("p",null,"线程修改变量后其他线程能否立即感知")]),l("li",null,[l("p",null,"原子性"),l("p",null,"操作是否不可分割，避免数据不一致")]),l("li",null,[l("p",null,"有序性"),l("p",null,"代码执行顺序是否符合预期")])],-1),l("h3",{id:"volatile-关键字",tabindex:"-1"},[i("volatile 关键字 "),l("a",{class:"header-anchor",href:"#volatile-关键字","aria-label":'Permalink to "volatile 关键字"'},"​")],-1),l("p",null,"核心特性",-1),l("ul",null,[l("li",null,[l("p",null,"可见性保证：所有线程直接访问共享内存中的变量值，而非本地缓存"),l("ul",null,[l("li",null,[l("p",null,"写操作：强制将修改后的值刷新到主内存")]),l("li",null,[l("p",null,"读操作：强制从主内存读取最新值")])])]),l("li",null,[l("p",null,"禁止指令重排序")])],-1),l("p",null,"使用限制：",-1),l("p",null,"不保证原子性，仅适用于单次读/写操作，无法处理复合操作",-1),l("p",null,"典型场景",-1),l("ul",null,[l("li",null,[l("p",null,"状态标志")]),l("li",null,[l("p",null,"配合 CAS 操作实现无锁并发")])],-1),l("h3",{id:"synchronized-关键字",tabindex:"-1"},[i("synchronized 关键字 "),l("a",{class:"header-anchor",href:"#synchronized-关键字","aria-label":'Permalink to "synchronized 关键字"'},"​")],-1),l("p",null,"核心特性",-1),l("ul",null,[l("li",null,[l("p",null,"原子性、排他性：同一时刻只允许一个线程进入同步代码")]),l("li",null,[l("p",null,"隐式锁机制：通过锁对象实现同步（锁粒度可以是实例对象、Class 对象或自定义对象）")]),l("li",null,[l("p",null,"可见性保证：线程退出同步代码时，修改的变量值强制刷新到主内存")])],-1),l("hr",null,null,-1),l("p",null,[i("下述代码是实现线程安全的单例模式的经典写法，被称为 "),l("code",null,"双重检查锁定")],-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," class"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    private"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton instance; "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ① volatile 关键字很重要！")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Singleton "),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getInstance"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        if"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (instance "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") { "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ② 第一次检查：避免不必要的同步")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"            synchronized"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (Singleton.class) { "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ③ 同步块，确保原子性")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"                if"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (instance "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") { "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ④ 第二次检查：防止重复创建")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                    instance "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Singleton"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ⑤ 创建实例")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"                }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"            }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"        return"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," instance;")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("h3",{id:"等待-通知机制",tabindex:"-1"},[i("等待/通知机制 "),l("a",{class:"header-anchor",href:"#等待-通知机制","aria-label":'Permalink to "等待/通知机制"'},"​")],-1),l("p",null,"通过 Object 类的 wait 、 notify 、 notiyall 方法实现的多线程协作模式",-1),l("p",null,"本质：基于共享对象的状态协调，一个线程通过释放锁进入等待状态，另一线程通过锁通知唤醒等待线程",-1),l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"方法"),l("th",null,"描述"),l("th",null,"使用条件")])]),l("tbody",null,[l("tr",null,[l("td",null,[l("code",null,"wait()")]),l("td",null,"释放对象锁，当前线程进入等待队列（WAITING），直到其他线程通知或中断"),l("td",null,"必须在同步块（synchronized）内调用")]),l("tr",null,[l("td",null,[l("code",null,"notify()")]),l("td",null,"随机唤醒对象等待队列中的一个线程，将其移到锁的同步队列（BLOCKED），等待获取锁后恢复执行"),l("td",null,"同一对象锁的持有者调用")]),l("tr",null,[l("td",null,[l("code",null,"notifyAll()")]),l("td",null,"唤醒对象等待队列中的所有线程，全部移到同步队列"),l("td",null,"同一对象锁的持有者调用")])])],-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 等待方（消费者）")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"synchronized"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock) {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    while"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (condition) {  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 循环防止虚假唤醒")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"        lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"wait"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 执行操作")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 通知方（生产者）")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"synchronized"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lock) {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 修改条件")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"notify"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 或 notifyAll()")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("p",null,"虚假唤醒：一个线程在没有被其他线程显式调用 notify() 或 notifyAll() 的情况下，从 wait() 方法中意外返回的现象",-1),l("h3",{id:"thread-join",tabindex:"-1"},[i("thread.join "),l("a",{class:"header-anchor",href:"#thread-join","aria-label":'Permalink to "thread.join"'},"​")],-1),l("p",null,"让当前线程等待另一个线程执行完毕后再继续执行",-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"thread."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"join"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 阻塞当前线程，直到 thread 执行结束")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("ul",null,[l("li",null,[l("p",null,"永久等待，直到目标线程自然终止（或被中断）；")]),l("li",null,[l("p",null,"如果目标线程已经结束，则立即返回。")])],-1),l("p",null,"本质是通过对象的等待/通知机制和锁的同步控制实现的",-1),l("p",null,"核心逻辑：当前线程获取目标线程对象的锁，并在循环中调用 wait() ，直到目标线程终止",-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," synchronized"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," join"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() throws InterruptedException {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 目标线程存活时持续等待")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    while"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"isAlive"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) {")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        wait"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"0"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");  "),l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 调用当前 Thread 对象的 wait()")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("p",null,"关键步骤",-1),l("ul",null,[l("li",null,[l("p",null,"加锁"),l("p",null,"synchronized 修饰的 join 方法获取目标线程对象的锁")]),l("li",null,[l("p",null,"循环检查存活状态"),l("ul",null,[l("li",null,[l("p",null,"若目标线程尚未终止 (isAlive() 为 true) ，当前线程调用 wait(0) 释放锁，并进入等待状态")]),l("li",null,[l("p",null,"若目标线程终止，wait(0) 退出循环，join() 方法返回")])])]),l("li",null,[l("p",null,"异步通知"),l("p",null,"目标线程结束时，JVM 内部自动调用其线程对象的 notifyAll() ，唤醒所有等待在该线程对象上的线程")])],-1),l("h2",{id:"daemon-线程",tabindex:"-1"},[i("Daemon 线程 "),l("a",{class:"header-anchor",href:"#daemon-线程","aria-label":'Permalink to "Daemon 线程"'},"​")],-1),l("h2",{id:"threadlocal",tabindex:"-1"},[i("ThreadLocal "),l("a",{class:"header-anchor",href:"#threadlocal","aria-label":'Permalink to "ThreadLocal"'},"​")],-1),l("p",null,"ThreadLocal 是 Java 中实现线程局部变量的工具类。",-1),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 存")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"threadLocalValue."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(`要保存的对象`)")]),i(`
`),l("span",{class:"line"}),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 取")]),i(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"`查看` "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," threadLocalValue."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),l("button",{class:"code-block-unfold-btn"})],-1),l("p",null,"底层实现",-1),l("ul",null,[l("li",null,[l("p",null,"每个 Thread 对象持有一个 ThreadLocal.ThreadLocalMap")]),l("li",null,[l("p",null,"该 Map 的 key 是 ThreadLocal 的弱引用")]),l("li",null,[l("p",null,"value 是强引用")])],-1),l("p",null,"风险：当 ThreadLocal 实例被回收（key → null），但线程长期存活（如线程池），value 无法被 GC，导致内存泄漏。",-1),l("p",null,"正确做法：用完务必调用 remove()",-1),l("h2",{id:"daemon-线程-1",tabindex:"-1"},[i("daemon 线程 "),l("a",{class:"header-anchor",href:"#daemon-线程-1","aria-label":'Permalink to "daemon 线程"'},"​")],-1),l("p",null,"守护线程，为其他线程提供服务，依附于用户线程。不影响 JVM 退出。",-1)])]),"main-header":s(()=>[n(a.$slots,"main-header")]),"main-header-after":s(()=>[n(a.$slots,"main-header-after")]),"main-nav":s(()=>[n(a.$slots,"main-nav")]),"main-content-before":s(()=>[n(a.$slots,"main-content-before")]),"main-content":s(()=>[n(a.$slots,"main-content")]),"main-content-after":s(()=>[n(a.$slots,"main-content-after")]),"main-nav-before":s(()=>[n(a.$slots,"main-nav-before")]),"main-nav-after":s(()=>[n(a.$slots,"main-nav-after")]),comment:s(()=>[n(a.$slots,"comment")]),footer:s(()=>[n(a.$slots,"footer")]),aside:s(()=>[n(a.$slots,"aside")]),"aside-custom":s(()=>[n(a.$slots,"aside-custom")]),default:s(()=>[n(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{J as default,b as usePageData};
