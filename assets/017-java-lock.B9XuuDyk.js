import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CF3jKIAV.js";import{_ as E}from"./ValaxyMermaid.vue_vue_type_script_setup_true_lang.CwKS2sag.js";import{d as A,a as y,u as m}from"./chunks/vue-router.0fijYp3S.js";import{a2 as b,a3 as s,a4 as a,a5 as l,a6 as n,P as C,a8 as v,B as S,a1 as F,D as f}from"./framework.CL_twgqk.js";import"./app.DJJRq6_7.js";import"./chunks/dayjs.BFInjCTz.js";import"./chunks/vue-i18n.CRimy4L_.js";import"./chunks/pinia.KHo6empO.js";/* empty css                    */import"./chunks/@vueuse/motion.DON3upiQ.js";import"./chunks/nprogress.DUFFUuWH.js";import"./YunComment.vue_vue_type_style_index_0_lang.lpZGJo7w.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.7-8ddEp8.js";import"./post.D4SLBNdn.js";const I=A("/posts/017-java-lock",async e=>JSON.parse('{"title":"é”","titleTemplate":"%s - yuier","description":"","frontmatter":{"title":"é”","titleTemplate":"%s - yuier","date":"2025-12-10 18:55:24","updated":"2025-12-10 18:55:24","author":"yuier","categories":["å¹¶å‘ç¼–ç¨‹"],"tags":["å¹¶å‘ç¼–ç¨‹","å¤šçº¿ç¨‹","Java","é”","å…«è‚¡æ–‡"],"cover":null,"hide":"index"},"headers":[],"relativePath":"pages/posts/017-java-lock.md","lastUpdated":1772277401000}'),{lazy:(e,u)=>e.name===u.name}),J={__name:"017-java-lock",setup(e,{expose:u}){const{data:p}=I(),d=m(),o=y(),r=Object.assign(o.meta.frontmatter||{},p.value?.frontmatter||{});return d.currentRoute.value.data=p.value,f("valaxy:frontmatter",r),globalThis.$frontmatter=r,u({frontmatter:{title:"é”",titleTemplate:"%s - yuier",date:"2025-12-10 18:55:24",updated:"2025-12-10 18:55:24",author:"yuier",categories:["å¹¶å‘ç¼–ç¨‹"],tags:["å¹¶å‘ç¼–ç¨‹","å¤šçº¿ç¨‹","Java","é”","å…«è‚¡æ–‡"],cover:null,hide:"index"}}),(t,i)=>{const k=E,h=g;return F(),b(h,{frontmatter:S(r)},{"main-content-md":s(()=>[i[0]||(i[0]=l("h2",{id:"synchronized",tabindex:"-1"},[n("synchronized "),l("a",{class:"header-anchor",href:"#synchronized","aria-label":'Permalink to "synchronized"'},"â€‹")],-1)),i[1]||(i[1]=l("p",null,"synchronized æ˜¯ Java æä¾›çš„ä¸€ç§å†…ç½®é”æœºåˆ¶",-1)),i[2]||(i[2]=l("ul",null,[l("li",null,[l("p",null,"ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªä»£ç å—æˆ–æ–¹æ³•")]),l("li",null,[l("p",null,"ä¿è¯å…±äº«å˜é‡çš„å¯è§æ€§ï¼ˆä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹åˆ»å¯è§ï¼‰")]),l("li",null,[l("p",null,"é˜²æ­¢æŒ‡ä»¤é‡æŽ’åº")])],-1)),i[3]||(i[3]=l("h3",{id:"ä½¿ç”¨æ–¹æ³•",tabindex:"-1"},[n("ä½¿ç”¨æ–¹æ³• "),l("a",{class:"header-anchor",href:"#ä½¿ç”¨æ–¹æ³•","aria-label":'Permalink to "ä½¿ç”¨æ–¹æ³•"'},"â€‹")],-1)),i[4]||(i[4]=l("ul",null,[l("li",null,[l("p",null,"å¯¹è±¡é”ï¼šåŒæ­¥å®žä¾‹æ–¹æ³•"),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," synchronized"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," method"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ä¸´ç•ŒåŒºä»£ç ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})]),l("p",null,"é”çš„æ˜¯å½“å‰å¯¹è±¡å®žä¾‹ã€‚å¤šä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå¯¹è±¡çš„è¯¥æ–¹æ³•æ—¶äº’æ–¥ï¼›ä¸åŒå¯¹è±¡ä¹‹é—´ä¸äº’æ–¥ã€‚")]),l("li",null,[l("p",null,"ç±»é”ï¼šåŒæ­¥é™æ€æ–¹æ³•"),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," static"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," synchronized"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," staticMethod"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"() {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ä¸´ç•ŒåŒºä»£ç ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})]),l("p",null,"é”çš„æ˜¯è¯¥ç±»çš„ class å¯¹è±¡ã€‚ æ‰€æœ‰çº¿ç¨‹è°ƒç”¨è¯¥é™æ€æ–¹æ³•éƒ½ä¼šäº’æ–¥ï¼Œæ— è®ºæ˜¯å¦åŒä¸€ä¸ªå¯¹è±¡ã€‚")]),l("li",null,[l("p",null,"åŒæ­¥ä»£ç å—"),l("p",null,"å¯ä»¥æŒ‡å®šé”å¯¹è±¡"),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"synchronized"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (lockObject) {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ä¸´ç•ŒåŒºä»£ç ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})]),l("p",null,"lockObject å¯ä»¥æ˜¯ä»»æ„éž null å¯¹è±¡ï¼ˆå¦‚æžœä¸º null ä¼šæŠ›å‡º NPEï¼‰"),l("p",null,"åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æŒæœ‰è¯¥å¯¹è±¡çš„ç›‘è§†å™¨é”ï¼Œè¿›å…¥è¯¥ä»£ç å—ã€‚å…¶ä»–çº¿ç¨‹è‹¥å°è¯•è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡ä¸ºé”çš„åŒæ­¥å—ï¼Œå°†è¢«é˜»å¡žï¼Œç›´åˆ°å½“å‰çº¿ç¨‹é‡Šæ”¾é”ã€‚"),l("p",null,"æ›´çµæ´»ï¼Œæ›´ç»†ç²’åº¦ï¼Œé¿å…é”ä½æ•´ä¸ªæ–¹æ³•ã€‚")])],-1)),i[5]||(i[5]=l("h3",{id:"å®žçŽ°åŽŸç†",tabindex:"-1"},[n("å®žçŽ°åŽŸç† "),l("a",{class:"header-anchor",href:"#å®žçŽ°åŽŸç†","aria-label":'Permalink to "å®žçŽ°åŽŸç†"'},"â€‹")],-1)),i[6]||(i[6]=l("p",null,"åŸºäºŽ JVM çš„ç›‘è§†å™¨æœºåˆ¶",-1)),i[7]||(i[7]=l("ol",null,[l("li",null,"å­—èŠ‚ç å±‚é¢")],-1)),i[8]||(i[8]=l("ul",null,[l("li",null,[l("p",null,"åŒæ­¥æ–¹æ³•"),l("p",null,[n("åœ¨æ–¹æ³•çš„è®¿é—®æ ‡å¿—ä¸­è®¾ç½® "),l("code",null,"ACC_SYNCHRONIZED"),n(" æ ‡å¿—ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯åŒæ­¥çš„")])]),l("li",null,[l("p",null,"åŒæ­¥ä»£ç å—"),l("p",null,[n("ç¼–è¯‘åŽç”Ÿæˆ "),l("code",null,"monitorenter"),n(" å’Œ "),l("code",null,"monitorexit"),n(" å­—èŠ‚ç æŒ‡ä»¤")]),l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// Java ä»£ç ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"synchronized"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (obj) {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // do something")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// ç¼–è¯‘åŽ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"monitorenter obj")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"...")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"monitorexit obj")])])]),l("button",{class:"code-block-unfold-btn"})])])],-1)),i[9]||(i[9]=l("ol",{start:"2"},[l("li",null,"monitor ä¸Žå¯¹è±¡å¤´")],-1)),i[10]||(i[10]=l("ul",null,[l("li",null,[l("p",null,"æ¯ä¸ª Java å¯¹è±¡æœ‰ä¸€ä¸ªå¯¹è±¡å¤´ï¼Œå…¶ä¸­åŒ…å« Mark Word")]),l("li",null,[l("p",null,"Mark Word ä¸­å­˜å‚¨äº†é”çŠ¶æ€ä»¥åŠæŒ‡å‘ Monitor çš„æŒ‡é’ˆ"),l("blockquote",null,[l("p",null,"é”çŠ¶æ€ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”")])]),l("li",null,[l("p",null,"monitor æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„äº’æ–¥é‡ï¼Œç”± JVM ç»´æŠ¤ï¼Œä¸Žæ¯ä¸ªå¯¹è±¡å…³è”")])],-1)),i[11]||(i[11]=l("ol",{start:"3"},[l("li",null,"é”çŠ¶æ€")],-1)),i[12]||(i[12]=l("ul",null,[l("li",null,[l("p",null,"æ— é”çŠ¶æ€ï¼šåˆå§‹çŠ¶æ€ã€‚")]),l("li",null,[l("p",null,"åå‘é”ï¼ˆBiased Lockingï¼‰ï¼šåå‘ç¬¬ä¸€ä¸ªèŽ·å–é”çš„çº¿ç¨‹ï¼Œé€‚åˆå•çº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—ã€‚")]),l("li",null,[l("p",null,"è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰ï¼šå¤šçº¿ç¨‹ç«žäº‰ä½†ä¸æ¿€çƒˆæ—¶ï¼Œé€šè¿‡ CAS è‡ªæ—‹å°è¯•èŽ·å–é”ï¼Œé¿å…ç³»ç»Ÿè°ƒç”¨ã€‚")]),l("li",null,[l("p",null,"é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰ï¼šç«žäº‰æ¿€çƒˆæ—¶ï¼Œå‡çº§ä¸º OS äº’æ–¥é”ï¼Œçº¿ç¨‹é˜»å¡ž/å”¤é†’ã€‚")])],-1)),i[13]||(i[13]=l("h2",{id:"volatile",tabindex:"-1"},[n("volatile "),l("a",{class:"header-anchor",href:"#volatile","aria-label":'Permalink to "volatile"'},"â€‹")],-1)),i[14]||(i[14]=l("p",null,"ä¿®é¥°å˜é‡åŽï¼Œä»»ä½•çº¿ç¨‹å¯¹è¯¥å˜é‡çš„ä¿®æ”¹ï¼Œéƒ½ä¼šç«‹åˆ» â€œå¹¿æ’­â€ ç»™æ‰€æœ‰å…¶ä»–çº¿ç¨‹",-1)),i[15]||(i[15]=l("p",null,"å®žçŽ°æ–¹å¼ï¼šå†…å­˜å±éšœ",-1)),i[16]||(i[16]=l("ul",null,[l("li",null,[l("p",null,"å†™æ“ä½œ"),l("p",null,"åœ¨å†™æ“ä½œåŽæ’å…¥ â€œå­˜å‚¨å±éšœâ€ï¼Œå¼ºåˆ¶å°†ä¿®æ”¹ä»Žå·¥ä½œå†…å­˜åˆ·æ–°åˆ°ä¸»å†…å­˜")]),l("li",null,[l("p",null,"è¯»æ“ä½œ"),l("p",null,"åœ¨è¯»æ“ä½œå‰æ’å…¥ â€œåŠ è½½å±éšœâ€ï¼Œå¼ºåˆ¶ä»Žä¸»å†…å­˜è¯»å–æœ€æ–°å€¼")])],-1)),i[17]||(i[17]=l("p",null,"åº”ç”¨åœºæ™¯ï¼š",-1)),i[18]||(i[18]=l("ul",null,[l("li",null,[l("p",null,"çŠ¶æ€æ ‡å¿— å¦‚ boolean ç±»åž‹å˜é‡")]),l("li",null,[l("p",null,"å•ä¾‹æ¨¡å¼ä¸­çš„åŒé‡æ£€æŸ¥é”")])],-1)),i[19]||(i[19]=l("p",null,"å±€é™æ€§",-1)),i[20]||(i[20]=l("ul",null,[l("li",null,[l("p",null,"ä¸èƒ½ä¿è¯åŽŸå­æ€§"),l("p",null,[n("ä¾‹å¦‚ "),l("code",null,"count++"),n(" ï¼ŒåŒ…å«è¯»å– count ã€ +1 ã€å†™å›ž count ä¸‰ä¸ªæ“ä½œï¼Œæ˜¯å¤åˆæ“ä½œï¼Œå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­")])]),l("li",null,[l("p",null,"ä¸èƒ½æ›¿ä»£é”"),l("p",null,"éœ€è¦ä¿è¯æ“ä½œåŽŸå­æ€§æ—¶ï¼Œåº”è¯¥ç”¨ synchronized æˆ–åŽŸå­ç±»")]),l("li",null,[l("p",null,"æœ‰æ€§èƒ½å¼€é”€"),l("p",null,"æ¯æ¬¡è¯»å†™éƒ½éœ€è¦ä»Žä¸»å†…å­˜è¿›è¡Œï¼Œå¢žåŠ å†…å­˜è®¿é—®æ¬¡æ•°å’Œå»¶è¿Ÿ")])],-1)),i[21]||(i[21]=l("h2",{id:"lock",tabindex:"-1"},[n("Lock "),l("a",{class:"header-anchor",href:"#lock","aria-label":'Permalink to "Lock"'},"â€‹")],-1)),i[22]||(i[22]=l("p",null,"åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹",-1)),i[23]||(i[23]=l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// åœ¨ try ä»£ç å—å¤–åˆ›å»ºé”")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"Lock lock "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," ReentrantLock"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),n(`
`),l("span",{class:"line"}),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// åœ¨éœ€è¦åŒæ­¥çš„ä»£ç å—ä¸­")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"lock"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"try"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // è®¿é—®å…±äº«èµ„æº")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    System.out."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"println"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"å½“å‰çº¿ç¨‹: "'),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," Thread."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"currentThread"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"getName"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"());")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"} "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"finally"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    lock."),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"unlock"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(); ")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ä¸€å®šè¦åœ¨ finally ä¸­é‡Šæ”¾é”ï¼Œé¿å…åœ¨ unlock å‰å‘ç”Ÿå¼‚å¸¸ï¼Œé”è¢«æ°¸è¿œæŒæœ‰æ— æ³•é‡Šæ”¾")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),i[24]||(i[24]=l("p",null,"ç‰¹æ€§",-1)),i[25]||(i[25]=l("ul",null,[l("li",null,[l("p",null,"å°è¯•éžé˜»å¡žåœ°èŽ·å¾—é”"),l("p",null,"å½“å‰çº¿ç¨‹å°è¯•èŽ·å¾—é”ï¼Œå¦‚æžœè¿™ä¸€æ—¶åˆ»é”æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹èŽ·å–ï¼Œåˆ™æˆåŠŸèŽ·å–å¹¶æŒæœ‰é”")]),l("li",null,[l("p",null,"èƒ½è¢«ä¸­æ–­åœ°èŽ·å¾—é”"),l("p",null,"èŽ·å–åˆ°é”çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå½“èŽ·å–åˆ°é”çš„çº¿ç¨‹è¢«ä¸­æ–­æ—¶ï¼Œä¸­æ–­å¼‚å¸¸å°†ä¼šè¢«æŠ›å‡ºï¼ŒåŒæ—¶é”ä¼šé‡Šæ”¾ã€‚è¿™ç‚¹ä¸Ž synchronized ä¸åŒ")]),l("li",null,[l("p",null,"è¶…æ—¶èŽ·å–é”"),l("p",null,"åœ¨æŒ‡å®šçš„æˆªæ­¢æ—¶é—´ä¹‹å‰èŽ·å¾—é”ï¼Œå¦‚æžœæˆªæ­¢æ—¶é—´åˆ°äº†ä»æ—§æ— æ³•èŽ·å¾—é”ï¼Œåˆ™è¿”å›ž")])],-1)),i[26]||(i[26]=l("h3",{id:"æŽ¥å£",tabindex:"-1"},[n("æŽ¥å£ "),l("a",{class:"header-anchor",href:"#æŽ¥å£","aria-label":'Permalink to "æŽ¥å£"'},"â€‹")],-1)),i[27]||(i[27]=l("ul",null,[l("li",null,[l("p",null,"void lock()"),l("p",null,"èŽ·å–é”ã€‚è‹¥é”å·²è¢«å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾"),l("p",null,"åŸºç¡€é”èŽ·å–ï¼Œæ— éœ€å“åº”ä¸­æ–­æˆ–è¶…æ—¶")]),l("li",null,[l("p",null,"void unlock()"),l("p",null,"é‡Šæ”¾é”ï¼Œå¿…é¡»åœ¨ finally å—ä¸­è°ƒç”¨ä»¥ç¡®ä¿é”çš„é‡Šæ”¾"),l("p",null,"ä¸Ž lock() é…å¯¹ä½¿ç”¨ï¼Œé˜²æ­¢èµ„æºæ³„éœ²")]),l("li",null,[l("p",null,"boolean tryLock()"),l("p",null,[l("strong",null,"éžé˜»å¡ž"),n("å°è¯•èŽ·å–é”ã€‚ç«‹å³è¿”å›žèŽ·å–ç»“æžœï¼šæˆåŠŸä¸º true ï¼Œå¤±è´¥ä¸º false")]),l("p",null,"éœ€åŠæ—¶åˆ¤æ–­é”çŠ¶æ€çš„åœºæ™¯ä¸‹ä½¿ç”¨")]),l("li",null,[l("p",null,"boolean tryLock(long time, TimeUnit unit)"),l("p",null,"å¯è¶…æ—¶å°è¯•èŽ·å–é”ã€‚åœ¨æŒ‡å®šæ—¶é—´å†…å°è¯•èŽ·å–é”ï¼Œè¶…æ—¶åˆ™è¿”å›ž falseï¼Œè¢«ä¸­æ–­åˆ™æŠ›å‡º InterruptException"),l("p",null,"éœ€è¦ç­‰å¾…æ—¶é—´çš„åŒæ­¥æ“ä½œä¸‹ä½¿ç”¨")]),l("li",null,[l("p",null,"void lockInterruptibly()"),l("p",null,"å¯ä¸­æ–­èŽ·å–é”ã€‚è‹¥é”è¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä½†å¯å“åº”ä¸­æ–­ï¼ˆæŠ›å‡º InterrupExceptionï¼‰"),l("p",null,"éœ€è¦æ”¯æŒä¸­æ–­çš„çº¿ç¨‹åä½œåœºæ™¯")]),l("li",null,[l("p",null,"Condition newCondition()"),l("p",null,"åˆ›å»ºä¸Žè¯¥é”ç»‘å®šçš„ Condition å¯¹è±¡ï¼Œç”¨äºŽçº¿ç¨‹é—´çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶"),l("p",null,"å®žçŽ°å¤æ‚çš„çº¿ç¨‹åè°ƒï¼ˆå¦‚å¤šæ¡ä»¶ç­‰å¾…ï¼‰")])],-1)),i[28]||(i[28]=l("h2",{id:"aqs",tabindex:"-1"},[n("AQS "),l("a",{class:"header-anchor",href:"#aqs","aria-label":'Permalink to "AQS"'},"â€‹")],-1)),i[29]||(i[29]=l("p",null,[n("å‚è€ƒåšå®¢: "),l("a",{href:"https://zhuanlan.zhihu.com/p/308452402",target:"_blank",rel:"noreferrer"},"å¹²è´§ï¼šååˆ†é’Ÿå¸¦ä½ æžæ‡‚ Java AQS æ ¸å¿ƒè®¾è®¡ä¸Žå®žçŽ°ï¼")],-1)),i[30]||(i[30]=l("p",null,"AbstractQueuedSynchronizer æ˜¯ç”¨æ¥æž„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æž¶",-1)),i[31]||(i[31]=l("p",null,"å®ƒä½¿ç”¨äº†ä¸€ä¸ª int æˆå‘˜å˜é‡ï¼ˆstateï¼‰è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºèŽ·å–çº¿ç¨‹çš„æŽ’é˜Ÿå·¥ä½œ",-1)),i[32]||(i[32]=l("p",null,"ä¸¤ç§åŒæ­¥æ¨¡å¼ï¼š",-1)),i[33]||(i[33]=l("ul",null,[l("li",null,[l("p",null,"ç‹¬å æ¨¡å¼ï¼šä»…å…è®¸å•çº¿ç¨‹èŽ·å–èµ„æº")]),l("li",null,[l("p",null,"å…±äº«æ¨¡å¼ï¼šå…è®¸å¤šçº¿ç¨‹åŒæ—¶èŽ·å–èµ„æº")])],-1)),i[34]||(i[34]=l("p",null,"å…¶æœ¬èº«æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æŽ¥å®žä¾‹åŒ–ï¼Œéœ€è¦å­ç±»ç»§æ‰¿å¹¶å®žçŽ°ç‰¹å®šæ–¹æ³•",-1)),i[35]||(i[35]=l("h3",{id:"åŒæ­¥çŠ¶æ€",tabindex:"-1"},[n("åŒæ­¥çŠ¶æ€ "),l("a",{class:"header-anchor",href:"#åŒæ­¥çŠ¶æ€","aria-label":'Permalink to "åŒæ­¥çŠ¶æ€"'},"â€‹")],-1)),i[36]||(i[36]=l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"private"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," volatile"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," int"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," state;")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),i[37]||(i[37]=l("p",null,"ç”¨äºŽè¡¨ç¤ºå…±äº«èµ„æºçš„å¯ç”¨çŠ¶æ€ã€‚å®ƒé€šè¿‡åŽŸå­æ“ä½œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯ AQS å®žçŽ°åŒæ­¥æœºåˆ¶çš„æ ¸å¿ƒ",-1)),i[38]||(i[38]=l("p",null,"åœ¨ AQS æ¡†æž¶ä¸‹ï¼Œçº¿ç¨‹èŽ·å–/é‡Šæ”¾èµ„æºæ˜¯å¦æˆåŠŸï¼Œå®Œå…¨å–å†³äºŽ state çš„å€¼ã€‚å¼€å‘è€…åªéœ€å…³æ³¨ state çš„é€»è¾‘ï¼Œæ— éœ€å¤„ç†å¤æ‚çš„çº¿ç¨‹æŽ’é˜Ÿæœºåˆ¶",-1)),i[39]||(i[39]=l("blockquote",null,[l("p",null,"æ‰“ä¸ªæ¯”æ–¹ï¼šå½“ state å€¼ä¸º 1 çš„æ—¶å€™è¡¨ç¤ºå½“å‰é”å·²ç»è¢«æŸçº¿ç¨‹å ç”¨ï¼Œé™¤éžç­‰å ç”¨çš„é”çš„çº¿ç¨‹é‡Šæ”¾é”åŽå°† state ç½®ä¸º 0ï¼Œå¦åˆ™å…¶å®ƒçº¿ç¨‹æ— æ³•èŽ·å–è¯¥é”ã€‚è¿™é‡Œçš„ state å˜é‡ç”¨ volatile å…³é”®å­—ä¿è¯å…¶åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚")],-1)),i[40]||(i[40]=l("h3",{id:"åŒæ­¥é˜Ÿåˆ—",tabindex:"-1"},[n("åŒæ­¥é˜Ÿåˆ— "),l("a",{class:"header-anchor",href:"#åŒæ­¥é˜Ÿåˆ—","aria-label":'Permalink to "åŒæ­¥é˜Ÿåˆ—"'},"â€‹")],-1)),i[41]||(i[41]=l("p",null,"æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŒå‘é“¾è¡¨ï¼ŒAQS å†…éƒ¨ä½¿ç”¨ä¸€ä¸ªé™æ€å†…éƒ¨ç±» Node æ¥è¡¨ç¤ºé˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹",-1)),i[42]||(i[42]=l("p",null,"AQS ç»´æŠ¤äº†é˜Ÿåˆ—çš„å¤´å°¾èŠ‚ç‚¹",-1)),i[43]||(i[43]=l("p",null,"Node èŠ‚ç‚¹è®¾è®¡",-1)),i[44]||(i[44]=l("ul",null,[l("li",null,[l("p",null,"ä¿å­˜å‰é©±ã€åŽç»§èŠ‚ç‚¹")]),l("li",null,[l("p",null,"èŠ‚ç‚¹çŠ¶æ€"),l("ul",null,[l("li",null,[l("p",null,"SIGNAL å½“å‰èŠ‚ç‚¹å¯ä»¥è¢«å®‰å…¨æŒ‚èµ·ï¼Œé”é‡Šæ”¾æ—¶å½“å‰çº¿ç¨‹ä¼šè¢«å”¤é†’åŽ»å°è¯•èŽ·å–é”")]),l("li",null,[l("p",null,"CANCEL è¡¨ç¤ºå½“å‰çº¿ç¨‹è¢«å–æ¶ˆï¼Œæ— éœ€å†å°è¯•èŽ·å–é”ï¼Œå¯ä»¥è¢«ç§»é™¤é˜Ÿåˆ—")])])])],-1)),i[45]||(i[45]=l("p",null,"å½“æ–°èŠ‚ç‚¹è¢«æ’å…¥é˜Ÿåˆ—æ—¶ï¼Œå¦‚æžœå‰é©±èŠ‚ç‚¹è¢«å–æ¶ˆï¼Œå¯ä»¥ä¸æ–­å›žæº¯ï¼Œè·³è¿‡æ— æ•ˆçº¿ç¨‹",-1)),i[46]||(i[46]=l("h3",{id:"èµ„æºç«žäº‰",tabindex:"-1"},[n("èµ„æºç«žäº‰ "),l("a",{class:"header-anchor",href:"#èµ„æºç«žäº‰","aria-label":'Permalink to "èµ„æºç«žäº‰"'},"â€‹")],-1)),i[47]||(i[47]=l("div",{class:"language-java max-h-900px"},[l("button",{title:"Copy code",class:"copy"}),l("span",{class:"lang"},"java"),l("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[l("code",{"v-pre":""},[l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"public"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," final"),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," void"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," acquire"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"int"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," arg) {")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"tryAcquire"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(arg) "),l("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&&")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        acquireQueued"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addWaiter"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(Node.EXCLUSIVE), arg))")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"        selfInterrupt"),l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")]),n(`
`),l("span",{class:"line"},[l("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),l("button",{class:"code-block-unfold-btn"})],-1)),i[48]||(i[48]=l("ul",null,[l("li",null,[l("p",null,"tryAcquired"),l("p",null,"å°è¯•èŽ·å–é”ï¼Œä¸ä¿è¯èŽ·å–")]),l("li",null,[l("p",null,"addWaiter"),l("p",null,"å°è¯•ç«žäº‰é”èµ„æºå¤±è´¥åŽï¼Œå°†è¯¥çº¿ç¨‹æž„é€ æˆä¸€ä¸ªèŠ‚ç‚¹æ’å…¥é˜Ÿåˆ—ä¸­ã€‚ä½¿ç”¨ enq æ–¹æ³•")]),l("li",null,[l("p",null,"acquireQueued"),l("p",null,"å‰é©±èŠ‚ç‚¹ä¸º head æ—¶ï¼Œå°è¯•èŽ·å–é”"),l("p",null,"å¦‚æžœå‰é©±èŠ‚ç‚¹ä¸ä¸º head ï¼Œæˆ–è€…èŽ·å–é”å¤±è´¥ï¼Œç”¨ shouldParkAfterFailedAcquire åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦éœ€è¦é˜»å¡žï¼›å¦‚æžœéœ€è¦é˜»å¡žï¼Œä½¿ç”¨ parkAndCheckInterrupt æŒ‚èµ·")])],-1)),i[49]||(i[49]=l("h3",{id:"waitstatus",tabindex:"-1"},[n("waitStatus "),l("a",{class:"header-anchor",href:"#waitstatus","aria-label":'Permalink to "waitStatus"'},"â€‹")],-1)),i[50]||(i[50]=l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"çŠ¶æ€å€¼"),l("th",null,"å€¼"),l("th",null,"å«ä¹‰"),l("th",null,"é€šä¿—è§£é‡Š")])]),l("tbody",null,[l("tr",null,[l("td",null,"CANCELLED"),l("td",null,"1"),l("td",null,"èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹å·²å–æ¶ˆç­‰å¾…"),l("td",null,'"ä¸æƒ³åƒäº†ï¼Œé€€å‡ºæŽ’é˜Ÿ"ï¼ˆçº¿ç¨‹è¢«ä¸­æ–­æˆ–ç­‰å¾…è¶…æ—¶ï¼‰')]),l("tr",null,[l("td",null,"SIGNAL"),l("td",null,"-1"),l("td",null,"åŽç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’"),l("td",null,'"ç­‰å‰ä¸€ä¸ªäººå«æˆ‘"ï¼ˆå‰é©±èŠ‚ç‚¹é‡Šæ”¾é”æ—¶ä¼šå”¤é†’æˆ‘ï¼‰')]),l("tr",null,[l("td",null,"CONDITION"),l("td",null,"-2"),l("td",null,"çº¿ç¨‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…"),l("td",null,'"è¦ç­‰å°èœæ‰èƒ½åƒ"ï¼ˆç­‰å¾…ç‰¹å®šæ¡ä»¶æ»¡è¶³ï¼‰')]),l("tr",null,[l("td",null,"PROPAGATE"),l("td",null,"-3"),l("td",null,"å…±äº«æ¨¡å¼ä¸‹éœ€è¦ä¼ æ’­å”¤é†’"),l("td",null,'"è‡ªåŠ©é¤ï¼Œå¤§å®¶ä¸€èµ·åƒ"ï¼ˆå…±äº«é”çš„å”¤é†’ä¼ æ’­ï¼‰')]),l("tr",null,[l("td",null,"0"),l("td",null,"0"),l("td",null,"åˆå§‹çŠ¶æ€ï¼Œæœªå‘ç”Ÿç‰¹æ®ŠçŠ¶æ€å˜åŒ–"),l("td",null,'"åˆšç«™åˆ°é˜Ÿä¼é‡Œ"ï¼ˆæ–°çº¿ç¨‹åˆšåŠ å…¥é˜Ÿåˆ—ï¼‰')])])],-1)),i[51]||(i[51]=l("p",null,"åœ¨ AQS ä¸­çš„ä½¿ç”¨åœºæ™¯",-1)),i[52]||(i[52]=l("ol",null,[l("li",null,[l("p",null,"çº¿ç¨‹å…¥é˜Ÿæ—¶"),l("p",null,"æ–°èŠ‚ç‚¹é»˜è®¤çŠ¶æ€ä¸º 0 ï¼Œé€šè¿‡ CAS æ“ä½œå°†æ–°èŠ‚ç‚¹åŠ å…¥é˜Ÿå°¾"),l("p",null,"å¦‚æžœå‰é©±èŠ‚ç‚¹çŠ¶æ€ä¸º SIGNAL ï¼Œçº¿ç¨‹ä¼šå°è¯•èŽ·å–é”")]),l("li",null,[l("p",null,"èŽ·å–é”å¤±è´¥æ—¶"),l("p",null,[n("å³ä¸Šæ–‡æåˆ°çš„ shouldParkAfterFailedAcquire æ–¹æ³•ã€‚ä¼šæ£€æŸ¥"),l("strong",null,"å‰é©±èŠ‚ç‚¹"),n("çš„ waitStatus")]),l("ul",null,[l("li",null,[l("p",null,"ä¸º SIGNAL --> å¯ä»¥å®‰å…¨é˜»å¡ž")]),l("li",null,[l("p",null,"ä¸º CANCELLED --> è·³è¿‡æ‰€æœ‰ CANCELLED èŠ‚ç‚¹")]),l("li",null,[l("p",null,"å…¶ä»–å€¼ --> å°†å‰é©±èŠ‚ç‚¹çŠ¶æ€è®¾ä¸º SIGNAL")])])]),l("li",null,[l("p",null,"çº¿ç¨‹è¢«å”¤é†’æ—¶"),l("p",null,"é”è¢«é‡Šæ”¾æ—¶ï¼Œæ£€æŸ¥å¤´èŠ‚ç‚¹çš„ waitStatus"),l("p",null,"å¦‚æžœæ—¶ SIGNAL --> å”¤é†’åŽç»§èŠ‚ç‚¹"),l("p",null,"å¦‚æžœæ—¶ PROPAGATE --> ä¼ æ’­å”¤é†’ç»™åŽç»­èŠ‚ç‚¹")]),l("li",null,[l("p",null,"æ¡ä»¶é˜Ÿåˆ—ä¸­"),l("p",null,"å½“çº¿ç¨‹è°ƒç”¨ await ï¼Œä¼šå°† waitStatus è®¾ä¸º CONDITION"),l("p",null,"å½“è°ƒç”¨ signal() ï¼Œä¼šå°†èŠ‚ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ŒwaitStatus å˜ä¸º 0")])],-1)),i[53]||(i[53]=l("h3",{id:"æ€»ç»“",tabindex:"-1"},[n("æ€»ç»“ "),l("a",{class:"header-anchor",href:"#æ€»ç»“","aria-label":'Permalink to "æ€»ç»“"'},"â€‹")],-1)),i[54]||(i[54]=l("blockquote",null,[l("p",null,"æ‡’å¾—å†™äº†ï¼Œç›´æŽ¥æŠ„äº†åƒé—®çš„å›žç­”")],-1)),i[55]||(i[55]=l("p",null,"ä»¥ä¸‹æ˜¯æ ¹æ®æ‚¨çš„è¦æ±‚è®¾è®¡çš„ çº¿ç¨‹ç«žäº‰èµ„æºå®Œæ•´æµç¨‹è„‘å›¾ï¼Œä»¥ç»“æž„åŒ–æ–‡æœ¬å½¢å¼å‘ˆçŽ°ï¼ˆæ¨¡æ‹Ÿè„‘å›¾å±‚çº§ï¼‰ã€‚é‡ç‚¹æ ‡æ³¨äº†å…³é”®æ–¹æ³•ã€å­—æ®µä½œç”¨å’ŒçŠ¶æ€æµè½¬ï¼Œç¡®ä¿é€»è¾‘æ¸…æ™°ã€è¦†ç›–æ‰€æœ‰è¦æ±‚ç‚¹ï¼š",-1)),i[56]||(i[56]=l("p",null,"ðŸŒŸ çº¿ç¨‹ç«žäº‰èµ„æºå…¨æµç¨‹è„‘å›¾ (åŸºäºŽ AQS æ¡†æž¶ï¼Œä»¥ ReentrantLock ä¸ºä¾‹)",-1)),i[57]||(i[57]=l("ol",null,[l("li",null,[l("p",null,"çº¿ç¨‹å¼€å§‹ç«žäº‰èµ„æº acquire(int arg) â†’ æ ¸å¿ƒå…¥å£ â”œâ”€ è°ƒç”¨ tryAcquire(arg) â”‚ â”œâ”€ å°è¯•èŽ·å–é”ï¼ˆä¿®æ”¹ stateï¼‰ â”‚ â””â”€ å¤±è´¥ â†’ è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆå…³é”®ï¼ï¼‰ â”‚ ï¼ˆæˆåŠŸï¼šç›´æŽ¥è¿”å›žï¼Œæ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼‰")]),l("li",null,[l("p",null,"ç«žäº‰å¤±è´¥ â†’ åŠ å…¥ç­‰å¾…é˜Ÿåˆ— addWaiter(Node.EXCLUSIVE) â†’ é˜Ÿåˆ—ç®¡ç† â”œâ”€ åˆ›å»ºæ–°èŠ‚ç‚¹ â”‚ â””â”€ Node node = new Node(currentThread, EXCLUSIVE) â”‚ waitStatus = 0ï¼ˆåˆå§‹çŠ¶æ€ï¼‰ â”œâ”€ è°ƒç”¨ enq(node)ï¼ˆå†…éƒ¨æ–¹æ³•ï¼Œå®‰å…¨å…¥é˜Ÿï¼‰ â”‚ â”œâ”€ é˜Ÿåˆ—ä¸ºç©ºï¼Ÿ â†’ åˆå§‹åŒ–å¤´èŠ‚ç‚¹ï¼ˆhead = new Node()ï¼‰ â”‚ â””â”€ é˜Ÿåˆ—éžç©º â†’ CAS å°¾éƒ¨æ’å…¥èŠ‚ç‚¹ â”‚ èŠ‚ç‚¹ç»“æž„ï¼šnode.prev = tail, tail.next = node â””â”€ è¿”å›žèŠ‚ç‚¹ â†’ ä¼ é€’ç»™ acquireQueued(node, arg)")]),l("li",null,[l("p",null,"åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼šè‡ªæ—‹ + æ™ºèƒ½æŒ‚èµ· acquireQueued(node, arg) â†’ æ ¸å¿ƒç­‰å¾…é€»è¾‘ â”œâ”€ å¾ªçŽ¯å°è¯•èŽ·å–ï¼ˆè‡ªæ—‹ï¼‰ â”‚ â”œâ”€ pred = node.predecessor() â†’ å‰é©±èŠ‚ç‚¹ â”‚ â”œâ”€ æ¡ä»¶ 1ï¼špred == head ä¸” tryAcquire æˆåŠŸï¼Ÿ â”‚ â”‚ â”œâ”€ æˆåŠŸ â†’ setHead(node)ï¼ˆæ–°å¤´èŠ‚ç‚¹ï¼‰ â”‚ â”‚ â””â”€ pred.next = nullï¼ˆGC å¸®åŠ©ï¼‰ â†’ ç«žäº‰æˆåŠŸï¼ â”‚ â””â”€ æ¡ä»¶ 2ï¼šå¤±è´¥ â†’ è°ƒç”¨ shouldParkAfterFailedAcquire(pred, node) â”‚ ï¼ˆå…³é”®ï¼šå‰é©±èŠ‚ç‚¹çŠ¶æ€å†³å®šæ˜¯å¦æŒ‚èµ·ï¼‰")]),l("li",null,[l("p",null,"shouldParkAfterFailedAcquireï¼šçŠ¶æ€å†³ç­–æ ¸å¿ƒ (å†³å®šæ˜¯å¦æŒ‚èµ·çº¿ç¨‹) â”œâ”€ æ£€æŸ¥å‰é©±èŠ‚ç‚¹ pred.waitStatus â”‚ â”œâ”€ SIGNAL (-1) â†’ è¿”å›ž true â”‚ â”‚ ï¼ˆå‰é©±æ‰¿è¯ºå”¤é†’æˆ‘ â†’ å®‰å…¨æŒ‚èµ·ï¼‰ â”‚ â”œâ”€ CANCELLED (1) â†’ æ¸…ç†é˜Ÿåˆ— â”‚ â”‚ ï¼ˆè·³è¿‡æ— æ•ˆèŠ‚ç‚¹ï¼Œæ›´æ–° node.prev = pred.prevï¼‰ â”‚ â””â”€ 0 æˆ– PROPAGATE (-3) â†’ è®¾ç½® pred.waitStatus = SIGNAL â”‚ ï¼ˆå…³é”®ï¼šé˜²æ­¢â€œå”¤é†’ä¸¢å¤±â€ï¼ï¼‰ â”‚ â†’ è¿”å›ž falseï¼ˆéœ€é‡æ–°å°è¯• tryAcquireï¼‰ â””â”€ æ ¹æ®è¿”å›žå€¼å†³å®šåŽç»­ â”œâ”€ è¿”å›ž true â†’ parkAndCheckInterrupt() â†’ æŒ‚èµ·çº¿ç¨‹ â””â”€ è¿”å›ž false â†’ ç»§ç»­å¾ªçŽ¯ï¼ˆé‡æ–° tryAcquireï¼‰ ðŸ’¡ ä¸ºä»€ä¹ˆå¿…é¡»è¿”å›ž falseï¼Ÿ é¿å…â€œå”¤é†’ä¸¢å¤±â€ï¼šçº¿ç¨‹ A é‡Šæ”¾é”æ—¶å”¤é†’çº¿ç¨‹ Bï¼Œä½†çº¿ç¨‹ B å¯èƒ½è¿˜åœ¨ shouldParkAfterFailedAcquire ä¸­ã€‚è®¾ç½® SIGNAL åŽé‡æ–°å°è¯•ï¼Œç¡®ä¿çº¿ç¨‹ B èƒ½åœ¨æŒ‚èµ·å‰èŽ·å–é”ã€‚")]),l("li",null,[l("p",null,"çº¿ç¨‹è¢«å”¤é†’ â†’ é‡å¤ç«žäº‰èµ„æº unparkSuccessor(head) â†’ é”é‡Šæ”¾æ—¶è§¦å‘ â”œâ”€ é”é‡Šæ”¾æµç¨‹ â”‚ â”œâ”€ tryRelease(arg) â†’ ä¿®æ”¹ state â”‚ â””â”€ å”¤é†’åŽç»§èŠ‚ç‚¹ï¼šunparkSuccessor(head) â”‚ ï¼ˆå¤´èŠ‚ç‚¹çŠ¶æ€å†³å®šå”¤é†’ç­–ç•¥ï¼‰ â”‚ â”œâ”€ ç‹¬å æ¨¡å¼ï¼šå¤´èŠ‚ç‚¹ waitStatus = SIGNAL â†’ å”¤é†’å•ä¸ªçº¿ç¨‹ â”‚ â””â”€ å…±äº«æ¨¡å¼ï¼šå¤´èŠ‚ç‚¹ waitStatus = PROPAGATE â†’ æ‰¹é‡å”¤é†’ â””â”€ è¢«å”¤é†’çº¿ç¨‹ï¼š â”œâ”€ ä»Ž parkAndCheckInterrupt() è¿”å›ž â””â”€ å›žåˆ° acquireQueued å¾ªçŽ¯ ï¼ˆæ­¤æ—¶ pred == head â†’ é‡æ–° tryAcquireï¼‰")]),l("li",null,[l("p",null,"ç«žäº‰æˆåŠŸ â†’ ä½¿ç”¨èµ„æº & é‡Šæ”¾é” release(arg) â†’ é”é‡Šæ”¾ â”œâ”€ tryRelease(arg) â†’ æˆåŠŸæ›´æ–° state â”œâ”€ å”¤é†’åŽç»§èŠ‚ç‚¹ â”‚ â”œâ”€ å¤´èŠ‚ç‚¹ waitStatus = SIGNAL â†’ unparkSuccessor(head) â”‚ â””â”€ å¤´èŠ‚ç‚¹ waitStatus = PROPAGATE â†’ ä¼ æ’­å”¤é†’ï¼ˆå…±äº«æ¨¡å¼ï¼‰ â””â”€ çº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç  (ä½¿ç”¨èµ„æºï¼Œå¦‚æ“ä½œå…±äº«æ•°æ®)")])],-1)),i[58]||(i[58]=l("p",null,"ðŸ”‘ waitStatus å…³é”®çŠ¶æ€æµè½¬å›¾",-1)),i[59]||(i[59]=l("table",null,[l("thead",null,[l("tr",null,[l("th",null,"åœºæ™¯"),l("th",null,"çŠ¶æ€å€¼"),l("th",null,"ä½œç”¨"),l("th",null,"ç¤ºä¾‹")])]),l("tbody",null,[l("tr",null,[l("td",null,"æ–°èŠ‚ç‚¹å…¥é˜Ÿ"),l("td",null,"0"),l("td",null,"åˆå§‹çŠ¶æ€"),l("td",null,"node = new Node(â€¦)")]),l("tr",null,[l("td",null,"å‰é©±èŠ‚ç‚¹éœ€å”¤é†’æˆ‘"),l("td",null,"SIGNAL"),l("td",null,"å‰é©±æ‰¿è¯ºé‡Šæ”¾æ—¶å”¤é†’æˆ‘"),l("td",null,"shouldParkAfterFailedAcquire è®¾ç½®")]),l("tr",null,[l("td",null,"çº¿ç¨‹å–æ¶ˆç­‰å¾…"),l("td",null,"CANCELLED"),l("td",null,"æ— æ•ˆèŠ‚ç‚¹ï¼Œæ¸…ç†é˜Ÿåˆ—"),l("td",null,"interrupt() æ—¶è®¾ç½®")]),l("tr",null,[l("td",null,"å…±äº«æ¨¡å¼å”¤é†’ä¼ æ’­"),l("td",null,"PROPAGATE"),l("td",null,"æ‰¹é‡å”¤é†’åŽç»­èŠ‚ç‚¹ï¼ˆSemaphoreï¼‰"),l("td",null,"Semaphore.release()")]),l("tr",null,[l("td",null,"å¤´èŠ‚ç‚¹ï¼ˆå“¨å…µï¼‰"),l("td",null,"0/SIGNAL/PROPAGATE"),l("td",null,"é˜Ÿåˆ—ç»“æž„èµ·ç‚¹ï¼Œä¸è¡¨ç¤ºå®žé™…çº¿ç¨‹"),l("td",null,"åˆå§‹ä¸º 0ï¼Œé‡Šæ”¾æ—¶å¯èƒ½ä¸º SIGNAL")])])],-1)),i[60]||(i[60]=l("p",null,"ðŸŒ å®Œæ•´æµç¨‹å›¾ç¤ºï¼ˆç®€åŒ–ç‰ˆï¼‰",-1)),C(k,v({code:"Z3JhcGggVEQKICAgIEFb57q_56iL5byA5aeL56ue5LqJXSAtLT58dHJ5QWNxdWlyZeWksei0pXwgQlvliqDlhaXnrYnlvoXpmJ_liJddCiAgICBCIC0tPiBDW2FkZFdhaXRlciDihpIgZW5xXQogICAgQyAtLT4gRFthY3F1aXJlUXVldWVk5b6q546vXQogICAgRCAtLT4gRXtwcmVkID09IGhlYWQ_fQogICAgRSAtLT585ZCmfCBGW3Nob3VsZFBhcmtBZnRlckZhaWxlZEFjcXVpcmVdCiAgICBGIC0tPnzorr7nva5TSUdOQUx8IEdbcGFya0FuZENoZWNrSW50ZXJydXB0XQogICAgRyAtLT4gSFvnur_nqIvmjILotbddCiAgICBIIC0tPiBJW-mUgemHiuaUvuaXtnVucGFya1N1Y2Nlc3Nvcl0KICAgIEkgLS0-IEpb6KKr5ZSk6YaSXQogICAgSiAtLT4gRAogICAgRCAtLT58cHJlZCA9PSBoZWFk5LiUdHJ5QWNxdWlyZeaIkOWKn3wgS1vnq57kuonmiJDlip9dCiAgICBLIC0tPiBMW-aJp-ihjOS4tOeVjOWMuuS7o-eggV0KICAgIEwgLS0-IE1bcmVsZWFzZSDihpIgdHJ5UmVsZWFzZV0KICAgIE0gLS0-IE5b5ZSk6YaS5ZCO57un6IqC54K5XQogICAgTiAtLT585aS06IqC54K5U0lHTkFMfCBPW-WUpOmGkuWNleS4que6v-eoi10KICAgIE4gLS0-fOWktOiKgueCuVBST1BBR0FURXwgUFvmibnph4_llKTphpJd"},{}),null,16),i[61]||(i[61]=l("p",null,"âœ… ä¸ºä»€ä¹ˆè¿™ä¸ªæµç¨‹æ­£ç¡®ï¼Ÿ",-1)),i[62]||(i[62]=l("ol",null,[l("li",null,"waitStatus ä½œç”¨ï¼š")],-1)),i[63]||(i[63]=l("p",null,"SIGNAL ç¡®ä¿å‰é©±èŠ‚ç‚¹é‡Šæ”¾é”æ—¶å”¤é†’åŽç»§ï¼ˆé¿å…å”¤é†’ä¸¢å¤±ï¼‰",-1)),i[64]||(i[64]=l("p",null,"PROPAGATE æ”¯æŒå…±äº«æ¨¡å¼æ‰¹é‡å”¤é†’ï¼ˆå¦‚ Semaphoreï¼‰",-1)),i[65]||(i[65]=l("ol",{start:"2"},[l("li",null,"shouldParkAfterFailedAcquire çš„å¿…è¦æ€§ï¼š")],-1)),i[66]||(i[66]=l("p",null,"é€šè¿‡è®¾ç½® SIGNAL ä¿è¯å”¤é†’å¯é ï¼Œé¿å…çº¿ç¨‹åœ¨ park å‰å°±é‡Šæ”¾äº†é”ã€‚",-1)),i[67]||(i[67]=l("ol",{start:"3"},[l("li",null,"å¤´èŠ‚ç‚¹çŠ¶æ€ï¼š")],-1)),i[68]||(i[68]=l("p",null,"ä¸æ˜¯å®žé™…ç­‰å¾…çº¿ç¨‹ï¼Œæ‰€ä»¥çŠ¶æ€å¯ä»¥æ˜¯ SIGNALï¼ˆç‹¬å ï¼‰æˆ– PROPAGATEï¼ˆå…±äº«ï¼‰ï¼Œä¸ä¸€å®šæ˜¯ SIGNALã€‚",-1)),i[69]||(i[69]=l("p",null,"ðŸ’¡ ä¸€å¥è¯æ€»ç»“ï¼š",-1)),i[70]||(i[70]=l("p",null,"â€œçº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶ï¼Œå‰é©±èŠ‚ç‚¹ç”¨ SIGNAL çŠ¶æ€æ‰¿è¯ºå”¤é†’æˆ‘ï¼›æˆ‘è¢«å”¤é†’åŽï¼Œå…ˆæ£€æŸ¥æ˜¯å¦èƒ½èŽ·å–é”ï¼ˆtryAcquireï¼‰ï¼ŒæˆåŠŸåˆ™è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¤±è´¥åˆ™ç»§ç»­æŒ‚èµ·ã€‚â€",-1)),i[71]||(i[71]=l("p",null,"è¿™ä»½è„‘å›¾å®Œå…¨è¦†ç›–äº†æ‚¨è¦æ±‚çš„ æ‰€æœ‰å…³é”®æ–¹æ³•ï¼ˆtryAcquire, addWaiter, acquireQueued, shouldParkAfterFailedAcquireï¼‰å’Œ å…³é”®å­—æ®µï¼ˆwaitStatusï¼‰ï¼Œå¹¶ç”¨æµç¨‹åŒ–é€»è¾‘è§£é‡Šäº†çŠ¶æ€æµè½¬ã€‚å¦‚éœ€è¿›ä¸€æ­¥ç»†åŒ–æŸçŽ¯èŠ‚ï¼Œå¯éšæ—¶è¡¥å……ï¼ ðŸ˜Š",-1))]),"main-header":s(()=>[a(t.$slots,"main-header")]),"main-header-after":s(()=>[a(t.$slots,"main-header-after")]),"main-nav":s(()=>[a(t.$slots,"main-nav")]),"main-content-before":s(()=>[a(t.$slots,"main-content-before")]),"main-content":s(()=>[a(t.$slots,"main-content")]),"main-content-after":s(()=>[a(t.$slots,"main-content-after")]),"main-nav-before":s(()=>[a(t.$slots,"main-nav-before")]),"main-nav-after":s(()=>[a(t.$slots,"main-nav-after")]),comment:s(()=>[a(t.$slots,"comment")]),footer:s(()=>[a(t.$slots,"footer")]),aside:s(()=>[a(t.$slots,"aside")]),"aside-custom":s(()=>[a(t.$slots,"aside-custom")]),default:s(()=>[a(t.$slots,"default")]),_:3},8,["frontmatter"])}}};export{J as default,I as usePageData};
