import{_ as h}from"./ValaxyMain.vue_vue_type_style_index_0_lang.CMOUyTHd.js";import{_ as k}from"./ValaxyMermaid.vue_vue_type_script_setup_true_lang.Bfw27ikb.js";import{d as L,a as q}from"./chunks/vue-router.0Vcg9tQ7.js";import{A as f,D as N,G as l,H as n,I as t,K as y,y as m,J as r,L as p,u as v,E as I}from"./framework.BuRQkX_n.js";import"./app.YzW-qI6y.js";import"./chunks/dayjs.BqMCNpOC.js";import"./chunks/vue-i18n.zFPGnNCI.js";import"./chunks/pinia.ux3KyVve.js";import"./chunks/@vueuse/motion.DQ4WtMoO.js";import"./chunks/nprogress.CZUfyql0.js";import"./YunComment.vue_vue_type_style_index_0_lang.DXXt1uee.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CfBNNSAM.js";import"./post.B9paYBkR.js";const B=L("/posts/003-qq-bot-brief-introduce",async i=>JSON.parse('{"title":"QQ 机器人漫谈","titleTemplate":"%s - yuier","description":"","frontmatter":{"title":"QQ 机器人漫谈","titleTemplate":"%s - yuier","date":"2025-03-13 02:14:14","updated":"2025-03-13 03:14:14","author":"yuier","cover":null},"headers":[{"level":2,"title":"第三方客户端","slug":"第三方客户端","link":"#第三方客户端","children":[]},{"level":2,"title":"添加我们需要的功能","slug":"添加我们需要的功能","link":"#添加我们需要的功能","children":[]},{"level":2,"title":"腾讯的反击","slug":"腾讯的反击","link":"#腾讯的反击","children":[]},{"level":2,"title":"QQ NT 的救赎","slug":"qq-nt-的救赎","link":"#qq-nt-的救赎","children":[{"level":3,"title":"劫持原生客户端路线","slug":"劫持原生客户端路线","link":"#劫持原生客户端路线","children":[]},{"level":3,"title":"拉格朗日和他的小伙伴们","slug":"拉格朗日和他的小伙伴们","link":"#拉格朗日和他的小伙伴们","children":[]}]},{"level":2,"title":"魔高一尺，道高一丈","slug":"魔高一尺-道高一丈","link":"#魔高一尺-道高一丈","children":[]},{"level":2,"title":"最后","slug":"最后","link":"#最后","children":[]}],"relativePath":"pages/posts/003-qq-bot-brief-introduce.md","lastUpdated":1761905721000}'),{lazy:(i,s)=>i.name===s.name}),A={__name:"003-qq-bot-brief-introduce",setup(i,{expose:s}){var g;const{data:b}=B(),d=q(),a=Object.assign(d.meta.frontmatter||{},((g=b.value)==null?void 0:g.frontmatter)||{});return d.meta.frontmatter=a,f("pageData",b.value),f("valaxy:frontmatter",a),globalThis.$frontmatter=a,s({frontmatter:{title:"QQ 机器人漫谈",titleTemplate:"%s - yuier",date:"2025-03-13 02:14:14",updated:"2025-03-13 03:14:14",author:"yuier",cover:null}}),(o,e)=>{const u=k,Q=h;return I(),N(Q,{frontmatter:v(a)},{"main-content-md":l(()=>[e[0]||(e[0]=t("blockquote",null,[t("p",null,[r("隔着网线，没人知道"),t("a",{href:"https://zh.moegirl.org.cn/zh-hans/%E8%B5%9B%E5%8D%9Aoo#.E8.B5.9B.E5.8D.9A.E7.8C.AB.E5.A8.98.2F.E8.B5.9B.E5.8D.9A.E6.B4.97.E8.84.91.E5.92.92",target:"_blank",rel:"noreferrer"},"你是一只猫娘")])],-1)),e[1]||(e[1]=t("p",null,"本文目的是对 QQ 机器人的一些基本概念进行介绍。",-1)),y(" more "),e[2]||(e[2]=t("h2",{id:"第三方客户端",tabindex:"-1"},[r("第三方客户端 "),t("a",{class:"header-anchor",href:"#第三方客户端","aria-label":'Permalink to "第三方客户端"'},"​")],-1)),e[3]||(e[3]=t("p",null,"QQ 平时是这样工作的：用户操作客户端，客户端与服务器进行网络报文交互，最终通过服务器与其他用户进行交流沟通",-1)),m(u,p({code:"Z3JhcGggQlQKCnVzZXIxW-eUqOaItzFdIC0t5pON5L2cLS0-IGNsaWVudDFb5a6i5oi356uvMV0KY2xpZW50MSA8LS3miqXmlofkuqTkupItLT4gc2VydmVyW-acjeWKoeWZqF0KdXNlcjJb55So5oi3Ml0gLS3mk43kvZwtLT4gY2xpZW50MlvlrqLmiLfnq68yXQpjbGllbnQyIDwtLeaKpeaWh-S6pOS6ki0tPiBzZXJ2ZXJb5pyN5Yqh5ZmoXQ"},{}),null,16),e[4]||(e[4]=t("p",null,[r("古时候有个段子叫 “隔着网络没人知道你是条狗”；同样地，隔着网线，服务器也很难判断这个发过来的数据包到底是客户端真实发出的，还是经过人为精心构造的（先暂时不谈腾讯的各种反制措施）。我们完全可以编写一段程序，假装成正版 QQ 客户端，与腾讯的服务器进行报文交互，我们把这段程序称为 "),t("code",null,"第三方客户端"),r(" 。早期很多 QQ 机器人都是基于这种方式实现的，比如大名鼎鼎的 "),t("a",{href:"https://github.com/mamoe/mirai",target:"_blank",rel:"noreferrer"},"mirai"),r(" .")],-1)),e[5]||(e[5]=t("p",null,"具体怎么做的，原理大体就是通过逆向工程获得客户端与服务器之间交互方式，比如用的什么协议，打的哪个端口。这操作多少有点灰色，而且我也只是略知大概，并不十分懂细节，所以只讲得了这些。",-1)),m(u,p({code:"Z3JhcGggQlQKCnVzZXIxW-eUqOaItzFdIC0tPiBjbGllbnQxW-esrOS4ieaWueWuouaIt-err10KY2xpZW50MSA8LS0-IHNlcnZlclvmnI3liqHlmahdCnVzZXIyW-eUqOaItzJdIC0tPiBjbGllbnQyW-WuouaIt-errzJdCmNsaWVudDIgPC0tPiBzZXJ2ZXJb5pyN5Yqh5ZmoXQ"},{}),null,16),e[6]||(e[6]=t("h2",{id:"添加我们需要的功能",tabindex:"-1"},[r("添加我们需要的功能 "),t("a",{class:"header-anchor",href:"#添加我们需要的功能","aria-label":'Permalink to "添加我们需要的功能"'},"​")],-1)),e[7]||(e[7]=t("p",null,[r("当然了，仅仅停留在复刻一个 QQ 客户端没啥太大的意义，我们想要的是一个"),t("s",null,"猫娘"),r("机器人。幸运的是，由于这个第三方客户端是我们自己编写的，我们可以自由地为其添加一些我们自定义的功能，比如对外暴露各种接口，比如向我们需要的地址发送我们想要的信息；或者干脆写一个"),t("s",null,"大家都喜欢的"),r("功能：当群里有人发出指令 "),t("code",null,"/色图"),r(" 时，机器人就向这个群发一张色图：")],-1)),e[8]||(e[8]=t("figure",null,[t("img",{src:"https://s2.loli.net/2025/03/12/LzNhMDa5T7ZVnUr.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),e[9]||(e[9]=t("blockquote",null,[t("p",null,[t("s",null,"骗你的，其实一点也不色，而且油腻仙贝也并不是猫娘")])],-1)),e[10]||(e[10]=t("p",null,"总之，现在的 QQ 是这样的：",-1)),m(u,p({code:"Z3JhcGggQlQKCkFAeyBzaGFwZTogbm90Y2gtcmVjdCwgbGFiZWw6ICLoh6rlrprkuYk8cD7oibLlm77lip_og70iIH0gLS0-IGNsaWVudDEKdXNlcjFb55So5oi3MV0gLS0-IGNsaWVudDFb56ys5LiJ5pa55a6i5oi356uvXQpjbGllbnQxIDwtLT4gc2VydmVyW-acjeWKoeWZqF0KdXNlcjJb55So5oi3Ml0gLS0-IGNsaWVudDJb5a6i5oi356uvMl0KY2xpZW50MiA8LS0-IHNlcnZlclvmnI3liqHlmahd"},{}),null,16),e[11]||(e[11]=t("p",null,"其实这样就算一个最简单的机器人了。",-1)),e[12]||(e[12]=t("p",null,[r("彼时 QQ 机器人繁荣发展，各种大大小小的框架、优秀实例层出不穷，开源社区也得到极大发展。比如上面提到的 mirai，还有 "),t("a",{href:"https://github.com/Mrs4s/go-cqhttp",target:"_blank",rel:"noreferrer"},"go-cqhttp"),r(" —— 这个项目的灵感来源 "),t("a",{href:"https://github.com/kyubotics/coolq-http-api",target:"_blank",rel:"noreferrer"},"coolq-http-api"),r(" 甚至还催生出了一套用于机器人框架与机器人应用之间通信使用的协议标准 "),t("a",{href:"https://github.com/botuniverse/onebot",target:"_blank",rel:"noreferrer"},"onebot"),r(" ，至今仍在持续发展。")],-1)),e[13]||(e[13]=t("p",null,[r("基于这些一级框架，还衍生出了更多二级框架、优秀实现，比如与 mirai 一样大名鼎鼎的 "),t("a",{href:"https://github.com/nonebot/nonebot",target:"_blank",rel:"noreferrer"},"nonebot"),r(", "),t("a",{href:"https://github.com/nonebot/nonebot2",target:"_blank",rel:"noreferrer"},"nonebot2"),r("，以及基于后者开发的 "),t("a",{href:"https://github.com/HibiKier/zhenxun_bot",target:"_blank",rel:"noreferrer"},"zhenxun_bot"),r(" ; 比如项目极庞大，完成度极高，社区内容极丰富的 "),t("a",{href:"https://github.com/koishijs/koishi",target:"_blank",rel:"noreferrer"},"koishi"),r("; 还有没那么大名鼎鼎，但是同样优秀，在工程实践上毫不逊色的 "),t("a",{href:"https://github.com/GraiaProject",target:"_blank",rel:"noreferrer"},"Graia Project"),r(" 等。行文至此，真是不禁叫人感慨：那种"),t("a",{href:"https://zh.moegirl.org.cn/zh-hans/%E4%BC%98%E5%8A%BF%E5%9C%A8%E6%88%91",target:"_blank",rel:"noreferrer"},"勃勃生机，万物竞发"),r("的境界，犹在眼前。")],-1)),e[14]||(e[14]=t("h2",{id:"腾讯的反击",tabindex:"-1"},[r("腾讯的反击 "),t("a",{class:"header-anchor",href:"#腾讯的反击","aria-label":'Permalink to "腾讯的反击"'},"​")],-1)),e[15]||(e[15]=t("p",null,"OK 了，我们上面引入第三方客户端概念的时候有意暂时略过了腾讯的各种反制措施。但是现实中，腾讯肯定不会这么爽快地同意我们自己手搓的客户端与服务器进行交互的，不管是从商业利益层面，还是从安全风险规避层面，或者其他层面考量。",-1)),e[16]||(e[16]=t("p",null,[r("有效的反制措包括频繁修改客户端与服务器之间的通信协议，让民间开发者无法及时破解；或者要求数据包进行签名，第三方客户端无法完成签名，也无法与服务器交互。盛极一时的 mirai 、go-cqhttp 就在腾讯的步步紧逼下频繁遭遇无法登录等问题，渐渐落寞。 （刚去看了下，发现 mirai 论坛其实还算活跃，看来这玩意生命力还挺顽强 "),t("a",{href:"https://mirai.mamoe.net/",target:"_blank",rel:"noreferrer"},"MiraiForum"),r("）")],-1)),e[17]||(e[17]=t("blockquote",null,[t("p",null,[r("还有一个我不愿意多谈的话题，那就是腾讯会动用法律手段制裁第三方 QQ 机器人 —— 如果第三方机器人盈利了的话，作为计算机界的口袋罪，非法侵入计算机系统的帽子极大概率是能被安上的。 "),t("a",{href:"https://www.zhihu.com/question/411466505",target:"_blank",rel:"noreferrer"},"如何看待近期大量的第三方QQ机器人停止运营？")])],-1)),e[18]||(e[18]=t("p",null,[r("总之，那会开源 bot 社区可以说是愁云惨淡万里凝，go-cqhttp 的这个 issue 鲜明地体现了 23 年的社区穷途末路的悲观心态："),t("a",{href:"https://github.com/Mrs4s/go-cqhttp/issues/2471",target:"_blank",rel:"noreferrer"},"QQ Bot的未来以及迁移建议"),r(" .")],-1)),e[19]||(e[19]=t("p",null,[r("不过天无绝人之路，正如 issue 中预言的，"),t("code",null,"协议库的时代已经过去, 接下来是Hook官方客户端的时代了"),r(" . 在第三方 bot 最低谷的 2023 年，bot 未来的希望正在悄然破壳而出。")],-1)),e[20]||(e[20]=t("h2",{id:"qq-nt-的救赎",tabindex:"-1"},[r("QQ NT 的救赎 "),t("a",{class:"header-anchor",href:"#qq-nt-的救赎","aria-label":'Permalink to "QQ NT 的救赎"'},"​")],-1)),e[21]||(e[21]=t("p",null,[r("2023 年，基于 QQNT 架构的新版 QQ 客户端推出。新 QQ 客户端的技术架构比较特殊，分为两层：基于 electron 的上层 UI 层，以及用 C++ 实现的下层核心层。下图便是微信公众号 "),t("code",null,"腾讯云开发者"),r(" 发布的 "),t("a",{href:"https://mp.weixin.qq.com/s/OQA7sUqqC_2yYRPhmxnotA",target:"_blank",rel:"noreferrer"},"Electron以慢著称，为什么桌面QQ却选择它做架构升级？"),r(" 一文中贴出的 NT QQ 架构示意图。")],-1)),e[22]||(e[22]=t("figure",null,[t("img",{src:"https://s2.loli.net/2025/03/12/MsyjoulJq1OitpK.jpg",alt:"image.jpg",loading:"lazy",decoding:"async"})],-1)),e[23]||(e[23]=t("blockquote",null,[t("p",null,"好时代，来临力！")],-1)),e[24]||(e[24]=t("h3",{id:"劫持原生客户端路线",tabindex:"-1"},[r("劫持原生客户端路线 "),t("a",{class:"header-anchor",href:"#劫持原生客户端路线","aria-label":'Permalink to "劫持原生客户端路线"'},"​")],-1)),e[25]||(e[25]=t("p",null,[r("electron 基于 web 前端技术的特性天然地有利于第三方开发。很快，24 年初，一个名为 "),t("a",{href:"https://github.com/LiteLoaderQQNT/LiteLoaderQQNT",target:"_blank",rel:"noreferrer"},"LiteLoaderQQNT"),r(" 的开源项目提交了它的第一个 commit. 这个项目的作用说起来很简单，就是提供了一套在 NT QQ 上开发插件的基础设施，包括插件加载框架，一些 API，一些 web 组件等。")],-1)),e[26]||(e[26]=t("p",null,[r("基于 "),t("code",null,"LiteLoader"),r(", "),t("a",{href:"https://github.com/LLOneBot/LLOneBot/tree/main",target:"_blank",rel:"noreferrer"},"LLOneBot"),r(" 项目出现了，成功地补齐了劫持客户端路线的最后一块拼图。 llob 可以劫持上层 UI 界面，实现调用底层的内核 API 。客户端启动后，llob 也会依据配置，同步启动 HTTP 服务或者 WS 服务，对外提供一系列接口，使得开发者可以最终自由操作 QQ 客户端。下图就是基于该项目实现 QQ 机器人的示意图。")],-1)),e[27]||(e[27]=t("figure",null,[t("img",{src:"https://s2.loli.net/2025/03/13/LxCbOjzeVUpME6P.png",alt:"image.png",loading:"lazy",decoding:"async"})],-1)),e[28]||(e[28]=t("p",null,[r("BTW，llob 项目社区还发展出了 "),t("code",null,"NapCat"),r(" 项目，二者算是姊妹项目。区别在于 llob 需要启动客户端才能运行，而 NapCat 不需要，这使后者更适合无图形界面的 Linux 服务器等环境。不过呢，因为一些场外的因素，我不太喜欢这个项目。不过项目本身的质量还是不错的。")],-1)),e[29]||(e[29]=t("p",null,"随着 llob 的出现，新路线使 QQ 机器人开发重新焕发了生机，活出了第二春。在早期第三方客户端时期就已经积累了一大批独立于客户端实现的 QQ 机器人应用层框架，现在可以以 OneBot 协议无缝对接 llob .",-1)),e[30]||(e[30]=t("h3",{id:"拉格朗日和他的小伙伴们",tabindex:"-1"},[r("拉格朗日和他的小伙伴们 "),t("a",{class:"header-anchor",href:"#拉格朗日和他的小伙伴们","aria-label":'Permalink to "拉格朗日和他的小伙伴们"'},"​")],-1)),e[31]||(e[31]=t("p",null,[r("进入 QQ NT 时代，依然有手搓仙人坚持古法熬制框架，复刻了 NT 协议的第三方客户端实现。其中影响力最大的莫过于 "),t("a",{href:"https://github.com/LagrangeDev/Lagrange.Core",target:"_blank",rel:"noreferrer"},"Lagrange.Core"),r(" . 正如文档所说，这是一个基于纯 C# 的 NTQQ 协议实现，是一个与 mirai 性质相同的项目。")],-1)),e[32]||(e[32]=t("p",null,[r("与之相关的还有 "),t("a",{href:"https://github.com/whitechi73/OpenShamrock",target:"_blank",rel:"noreferrer"},"OpenShamrock"),r(" 和 "),t("a",{href:"https://github.com/chrononeko/chronocat",target:"_blank",rel:"noreferrer"},"Chronocat"),r(", 这仨的开发者好像有那个什么 py 交易，互相把对方标为自己的 "),t("code",null,"相关项目"),r(" 。OpenShamrock 是个在手机上运行的基于 NTQQ 的框架，性质类似于手机版 llob . 至于 Chronocat ，这个就跟 llob 很相似了，区别在于这个用的不是 OneBot 协议，而是 "),t("a",{href:"https://satori.js.org/zh-CN/introduction.html",target:"_blank",rel:"noreferrer"},"Satori"),r(" 协议。")],-1)),e[33]||(e[33]=t("h2",{id:"魔高一尺-道高一丈",tabindex:"-1"},[r("魔高一尺，道高一丈 "),t("a",{class:"header-anchor",href:"#魔高一尺-道高一丈","aria-label":'Permalink to "魔高一尺，道高一丈"'},"​")],-1)),e[34]||(e[34]=t("p",null,"很可惜，开源社区没有图恒宇，我们总是无法给予 QQ 机器人完整的一生。基于原生客户端实现机器人的路线固然规避了协议方面被围追堵截的状况；但是同时，腾讯也拥有了检测客户端状况是否异常的能力，隔着网线，腾讯终于发现了你其实是个猫娘。",-1)),e[35]||(e[35]=t("p",null,[r("从 24 年底、25年初开始，"),t("code",null,"LiteLoaderQQNT"),r(" 用户就频繁出现账号被风控的情况，尤其是安装了 llob 这种对客户端影响较大的插件时风险更大。llob 刚问世时动辄挂几个月不出问题的情况再也不是那么容易复现的了，现在大都在掰着手指头数着日子等风控。")],-1)),e[36]||(e[36]=t("blockquote",null,[t("p",null,[t("a",{href:"https://github.com/LLOneBot/LLOneBot/issues/534",target:"_blank",rel:"noreferrer"},"探讨一下腾讯封号的机制")])],-1)),e[37]||(e[37]=t("p",null,"戏剧性的是，随着签名服务项目的传播，原先已经陷入低谷的第三方客户端路线反而同样焕发了第二春，而且目前似乎比基于 hook 原生客户端路线的项目还要稳定些。",-1)),e[38]||(e[38]=t("h2",{id:"最后",tabindex:"-1"},[r("最后 "),t("a",{class:"header-anchor",href:"#最后","aria-label":'Permalink to "最后"'},"​")],-1)),e[39]||(e[39]=t("p",null,"该说的都说得差不多了。其实还有个腾讯官方推出的机器人项目，论起来应该也讲一讲；但是我厌恶腾讯的上述种种做派，再加上我一个小小个人开发者确实没有资格开发官方机器人，我也不了解这玩意，也不知道该说些什么，我就把它归入不该说的行列中了。",-1)),e[40]||(e[40]=t("p",null,"最后，希望天再次不绝人之路，让第三方机器人这个产业能再次逢凶化吉，遇难呈祥，我这种普通开发者也能给 bot 一个完整的一生。",-1))]),"main-header":l(()=>[n(o.$slots,"main-header")]),"main-header-after":l(()=>[n(o.$slots,"main-header-after")]),"main-nav":l(()=>[n(o.$slots,"main-nav")]),"main-content-before":l(()=>[n(o.$slots,"main-content-before")]),"main-content":l(()=>[n(o.$slots,"main-content")]),"main-content-after":l(()=>[n(o.$slots,"main-content-after")]),"main-nav-before":l(()=>[n(o.$slots,"main-nav-before")]),"main-nav-after":l(()=>[n(o.$slots,"main-nav-after")]),comment:l(()=>[n(o.$slots,"comment")]),footer:l(()=>[n(o.$slots,"footer")]),aside:l(()=>[n(o.$slots,"aside")]),"aside-custom":l(()=>[n(o.$slots,"aside-custom")]),default:l(()=>[n(o.$slots,"default")]),_:3},8,["frontmatter"])}}};export{A as default,B as usePageData};
